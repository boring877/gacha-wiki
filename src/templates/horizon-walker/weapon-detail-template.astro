---
import { Image } from 'astro:assets';
import WeaponDetailLayout from '../../layouts/horizon-walker/WeaponDetailLayout.astro';
import Breadcrumb from '../../components/horizon-walker/Breadcrumb.astro';

// Import weapon data
import { HORIZON_WALKER_WEAPONS } from '../../data/horizon-walker/weapons.js';

// Get weapon slug from URL
const { weapon: weaponSlug } = Astro.params;

// Find weapon data
const weapon = HORIZON_WALKER_WEAPONS.find(w => w.id === weaponSlug);

if (!weapon) {
  return Astro.redirect('/guides/horizon-walker/weapons/');
}


// Find previous and next weapons for navigation
const currentIndex = HORIZON_WALKER_WEAPONS.findIndex(w => w.id === weaponSlug);
const prevWeapon = currentIndex > 0 ? HORIZON_WALKER_WEAPONS[currentIndex - 1] : null;
const nextWeapon = currentIndex < HORIZON_WALKER_WEAPONS.length - 1 ? HORIZON_WALKER_WEAPONS[currentIndex + 1] : null;

// SEO metadata
const title = `${weapon.name} - ${weapon.character.name}'s Weapon | Horizon Walker Wiki`;
const description = `Complete guide for ${weapon.name}, the exclusive ${weapon.rarity} weapon for ${weapon.character.name} in Horizon Walker. View stats, unique skills, and weapon details.`;

export const prerender = true;
---

<WeaponDetailLayout
  title={title}
  description={description}
  weaponName={weapon.name}
>
  <!-- Breadcrumb Navigation -->
  <Breadcrumb
    autoGenerate={true}
    gameKey="horizon-walker"
    currentPageName={weapon.name}
    showBackButton={true}
  />

  <div class="weapon-detail-container">
    <!-- Hero Section -->
    <section class="weapon-hero">
      <div class="weapon-hero-content">
        <div class="weapon-hero-image">
          <Image
            src={weapon.image}
            alt={weapon.name}
            width={200}
            height={200}
          />
        </div>

        <div class="weapon-hero-info">
          <h1 class="weapon-detail-name">{weapon.name}</h1>
          <p class="weapon-detail-type">
            {weapon.type} • <span class="hw-badge" data-rarity={weapon.rarity}>{weapon.rarity}</span>
          </p>

          <div class="weapon-detail-character">
            <span class="weapon-detail-character-label">Exclusive Weapon For</span>
            <span class="weapon-detail-character-name">{weapon.character.name}</span>
            <a href={`/guides/horizon-walker/characters/${weapon.character.slug}/`} class="weapon-detail-character-link">
              View Character →
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Content Grid -->
    <div class="weapon-content-grid">
      <!-- Stats Section -->
      <section class="weapon-stats-card">
        <h2 class="weapon-stats-title">Weapon Stats</h2>

        {Object.keys(weapon.stats).length > 0 ? (
          <div class="weapon-stats-list">
            {weapon.stats.weaponMeleeAtk && (
              <div class="weapon-stat-row">
                <span class="weapon-stat-name">Melee Attack</span>
                <span class="weapon-stat-value">{weapon.stats.weaponMeleeAtk}</span>
              </div>
            )}
            {weapon.stats.weaponMagicAtk && (
              <div class="weapon-stat-row">
                <span class="weapon-stat-name">Magic Attack</span>
                <span class="weapon-stat-value">{weapon.stats.weaponMagicAtk}</span>
              </div>
            )}
            {weapon.stats.weaponRangedAtk && (
              <div class="weapon-stat-row">
                <span class="weapon-stat-name">Ranged Attack</span>
                <span class="weapon-stat-value">{weapon.stats.weaponRangedAtk}</span>
              </div>
            )}
            {weapon.stats.magicAtkBonus && (
              <div class="weapon-stat-row">
                <span class="weapon-stat-name">Magic ATK Bonus</span>
                <span class="weapon-stat-value">{weapon.stats.magicAtkBonus}</span>
              </div>
            )}
            {weapon.stats.critDmgBonus && (
              <div class="weapon-stat-row">
                <span class="weapon-stat-name">Critical DMG Bonus</span>
                <span class="weapon-stat-value">{weapon.stats.critDmgBonus}</span>
              </div>
            )}
          </div>
        ) : (
          <p style="color: var(--hw-text-muted); font-style: italic;">
            No stat data available yet
          </p>
        )}
      </section>

      <!-- Skills Section -->
      <section class="weapon-skills-card">
        <div class="weapon-skills-header">
          <h2 class="weapon-skills-title">Weapon Skills</h2>
        </div>

        {weapon.skill ? (
          <div class="weapon-skill-block">
            <div class="weapon-skill-header">
              <h3 class="weapon-skill-name">{weapon.skill.name}</h3>
              <span class="weapon-skill-type">{weapon.skill.type}</span>
            </div>
            <p class="weapon-skill-description">{weapon.skill.description}</p>
          </div>
        ) : (
          <p style="color: var(--hw-text-muted); font-style: italic;">
            Skill information coming soon
          </p>
        )}
      </section>
    </div>

    <!-- Navigation -->
    <nav class="weapon-nav">
      {prevWeapon && (
        <a href={`/guides/horizon-walker/weapons/${prevWeapon.id}/`} class="weapon-nav-btn">
          ← {prevWeapon.name}
        </a>
      )}

      <a href="/guides/horizon-walker/weapons/" class="weapon-nav-all">
        All Weapons
      </a>

      {nextWeapon && (
        <a href={`/guides/horizon-walker/weapons/${nextWeapon.id}/`} class="weapon-nav-btn">
          {nextWeapon.name} →
        </a>
      )}
    </nav>
  </div>
</WeaponDetailLayout>