---
// Layout for individual Limited Time Challenge boss detail pages
import BBBaseHead from '../../components/busty-burst/BBBaseHead.astro';
import GameSEO from '../../components/GameSEO.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import GameNavigationHeader from '../../components/GameNavigationHeader.astro';
import MobileMenu from '../../components/MobileMenu.astro';
import CustomScrollbar from '../../components/CustomScrollbar.astro';
import Analytics from '../../components/Analytics.astro';
import DecorativeLines from '../../components/DecorativeLines.astro';
import Breadcrumb from '../../components/busty-burst/Breadcrumb.astro';
import BossIcon from '../../components/busty-burst/BossIcon.astro';
import BuffIcon from '../../components/busty-burst/BuffIcon.astro';
import SkillIcon from '../../components/busty-burst/SkillIcon.astro';
import PaladinImage from '../../components/busty-burst/PaladinImage.astro';
import ElementImage from '../../components/busty-burst/ElementImage.astro';
import RarityImage from '../../components/busty-burst/RarityImage.astro';
import WeaponIcon from '../../components/busty-burst/WeaponIcon.astro';
import PositionImage from '../../components/busty-burst/PositionImage.astro';
import TypeofATKImage from '../../components/busty-burst/TypeofATKImage.astro';
import { getCharacterDataBySlug } from '../../data/busty-burst/character-database.js';
import { getSupportDataById } from '../../data/busty-burst/support-data.js';

// Import CSS files
import '../../styles/games/busty-burst/busty-burst-colors.css';
import '../../styles/global.css';
import '../../styles/typography.css';
import '../../styles/games/busty-burst/busty-burst-layout.css';
import '../../styles/games/busty-burst/busty-burst-limited-time-challenges.css';
import '../../styles/games/busty-burst/busty-burst-limited-time-challenges-detail.css';
import '../../styles/games/busty-burst/busty-burst-badges.css';

export interface Props {
  challenge: {
    slug: string;
    name: string;
    eventId: number;
    eventName?: string;
    bossIcon: string;
    level: number;
    timeLimit: number;
    endDate: string;
    status: 'active' | 'ended' | 'upcoming';
    weakness: {
      element: string;
      description: string;
      icon: string;
    };
    resistances: Array<{
      element: string;
      reduction: number;
      icon: string;
    }>;
    statusResistances: Array<{
      name: string;
      chance: number;
      level: string;
      exploitable: boolean;
      icon: string;
      description?: string;
    }>;
    stats: {
      hp: string;
      hpNote?: string;
      atk: number;
      matk: number;
      def: number;
      mdef: number;
      atkCrit: number;
      matkCrit: number;
      hit: number;
      block: number;
      mpRecovery: number;
    };
    skills: {
      normalAttack: {
        id: number;
        name: string;
        nameEn: string;
        target: string;
        damage: string;
        type: string;
      };
      regularSkills: Array<{
        id: number;
        name: string;
        nameEn: string;
        target: string;
        damage: string;
        effect: string;
        cooldown?: number;
        debuffIcons?: string[];
      }>;
      timeTriggeredSkills: Array<{
        timeLeft: number;
        id: number;
        name: string;
        nameEn: string;
        target: string;
        effect: string;
        debuffIcon?: string;
      }>;
    };
    strategy: {
      bestElement: string;
      bestElementNote: string;
      avoidElements: string[];
      exploitableDebuffs: Array<{ name: string; resistChance: number }>;
      avoidDebuffs: Array<{ name: string; reason: string }>;
      watchOutFor: Array<{ time: number; description: string }>;
    };
    rewards?: {
      totalPointReward: number;
      maxDamageRankReward: number;
      totalDamageRankReward: number;
    };
  };
}

const { challenge } = Astro.props;
const title = `${challenge.name} - Limited Time Challenge | Busty Burst`;
const description = `Complete boss guide for ${challenge.name} in Busty Burst. Level ${challenge.level}, ${challenge.timeLimit}s time limit. Weak to ${challenge.weakness.element} (+50% DMG). Stats, skills, debuffs & strategy tips.`;

// SEO keywords for this boss
const bossKeywords = [
  challenge.name,
  'limited time challenge',
  'boss guide',
  `${challenge.weakness.element} weakness`,
  'busty burst boss',
  'LTC guide',
  ...challenge.strategy.exploitableDebuffs.slice(0, 3).map(d => d.name.toLowerCase()),
];
---

<html lang="en">
  <head>
    <BBBaseHead title={title} description={description} />
    <GameSEO
      gameKey="busty-burst"
      title={title}
      description={description}
      customImage="/images/games/Busty_Burst/BG/bg_02.webp"
      additionalKeywords={bossKeywords}
    />
  </head>
  <body class="busty-burst-body">
    <CustomScrollbar />
    <div class="bg-layer bg-primary"></div>
    <div class="bg-layer bg-accent-1"></div>
    <div class="bg-layer bg-accent-2"></div>

    <div class="busty-burst-content">
      <Header />
      <GameNavigationHeader currentPath={Astro.url.pathname} gameKey="busty-burst" />
      <MobileMenu />

      <div class="busty-burst-container">
        <main class="busty-burst-main">
          <!-- Title Section -->
          <section class="bb-title-only-section">
            <h2 class="bb-title-only-heading">{challenge.name}</h2>
            <DecorativeLines />
          </section>

          <Breadcrumb autoGenerate={true} gameKey="busty-burst" showBackButton={true} />

          <div class="content-area">
            <article class="bb-ltc-detail-container" itemscope itemtype="https://schema.org/Article">
              <!-- Boss Header -->
              <div class="bb-ltc-detail-header">
                <div class="bb-ltc-detail-boss-image">
                  <BossIcon fileName={challenge.bossIcon} alt={challenge.name} loading="eager" />
                </div>
                <div class="bb-ltc-detail-header-info">
                  <h1 class="bb-ltc-detail-title">{challenge.name}</h1>
                  <div class="bb-ltc-detail-meta">
                    <span class="bb-ltc-detail-meta-item">
                      <span class="bb-ltc-detail-meta-label">Level:</span>
                      <span class="bb-ltc-detail-meta-value">{challenge.level}</span>
                    </span>
                    <span class="bb-ltc-detail-meta-item">
                      <span class="bb-ltc-detail-meta-label">Time:</span>
                      <span class="bb-ltc-detail-meta-value">{challenge.timeLimit}s</span>
                    </span>
                    <span class="bb-ltc-detail-meta-item">
                      <span class="bb-ltc-detail-meta-label">Status:</span>
                      <span class="bb-ltc-status-badge" data-status={challenge.status}>{challenge.status}</span>
                    </span>
                  </div>
                </div>
              </div>

              <!-- Boss Stats -->
              <section class="bb-ltc-detail-section">
                <h2 class="bb-ltc-section-title">Boss Stats</h2>
                <div class="bb-ltc-detail-card">
                  <table class="bb-ltc-stats-table">
                    <tr>
                      <th>HP</th>
                      <td>{challenge.stats.hp}{challenge.stats.hpNote && <span class="bb-ltc-stat-note">({challenge.stats.hpNote})</span>}</td>
                    </tr>
                    <tr>
                      <th>ATK</th>
                      <td>{challenge.stats.atk.toLocaleString()}</td>
                    </tr>
                    <tr>
                      <th>MATK</th>
                      <td>{challenge.stats.matk.toLocaleString()}</td>
                    </tr>
                    <tr>
                      <th>DEF / MDEF</th>
                      <td>{challenge.stats.def} / {challenge.stats.mdef}</td>
                    </tr>
                    <tr>
                      <th>Crit (ATK / MATK)</th>
                      <td>{challenge.stats.atkCrit} / {challenge.stats.matkCrit}</td>
                    </tr>
                    <tr>
                      <th>HIT / BLOCK</th>
                      <td>{challenge.stats.hit} / {challenge.stats.block}</td>
                    </tr>
                  </table>
                </div>
              </section>

              <!-- Combat Info (Damage Type, Position, Skill Loop) -->
              {(challenge.damageType || challenge.position || challenge.skillLoop) && (
                <section class="bb-ltc-detail-section">
                  <h2 class="bb-ltc-section-title">Combat Info</h2>
                  <div class="bb-ltc-detail-card">
                    <div class="bb-ltc-combat-info-grid">
                      {challenge.damageType && (
                        <div class="bb-ltc-combat-info-item">
                          <span class="bb-ltc-combat-info-label">Damage Type:</span>
                          <TypeofATKImage fileName={`${challenge.damageType}.png`} alt={challenge.damageType} width={24} height={24} />
                          <span class="bb-ltc-combat-info-value">{challenge.damageType}</span>
                        </div>
                      )}
                      {challenge.position && (
                        <div class="bb-ltc-combat-info-item">
                          <span class="bb-ltc-combat-info-label">Position:</span>
                          <PositionImage fileName={`${challenge.position}.png`} alt={challenge.position} width={24} height={24} />
                          <span class="bb-ltc-combat-info-value">{challenge.position}</span>
                        </div>
                      )}
                    </div>
                    {challenge.skillLoop && (
                      <div class="bb-ltc-skill-loop">
                        <div class="bb-ltc-skill-loop-label">Skill Loop:</div>
                        <div class="bb-ltc-skill-loop-pattern">
                          <div class="bb-ltc-skill-loop-row">
                            <span class="bb-ltc-skill-loop-title">Opening:</span>
                            <span class="bb-ltc-skill-loop-sequence">
                              {challenge.skillLoop.first.map((action, i) => {
                                const skillIcon = action === 0
                                  ? challenge.skills.normalAttack?.skillIcon
                                  : challenge.skills.regularSkills?.[action - 1]?.skillIcon;
                                return (
                                  <span class={`bb-ltc-action-icon action-${action}`} title={action === 0 ? 'Normal' : `Skill ${action}`}>
                                    {skillIcon ? (
                                      <SkillIcon skillId={skillIcon} alt={action === 0 ? 'Normal' : `S${action}`} width={32} height={32} />
                                    ) : (
                                      <span class="bb-ltc-action-badge">{action === 0 ? 'N' : `S${action}`}</span>
                                    )}
                                  </span>
                                );
                              })}
                            </span>
                          </div>
                          <div class="bb-ltc-skill-loop-row">
                            <span class="bb-ltc-skill-loop-title">Loop:</span>
                            <span class="bb-ltc-skill-loop-sequence">
                              {challenge.skillLoop.loop.map((action, i) => {
                                const skillIcon = action === 0
                                  ? challenge.skills.normalAttack?.skillIcon
                                  : challenge.skills.regularSkills?.[action - 1]?.skillIcon;
                                return (
                                  <span class={`bb-ltc-action-icon action-${action}`} title={action === 0 ? 'Normal' : `Skill ${action}`}>
                                    {skillIcon ? (
                                      <SkillIcon skillId={skillIcon} alt={action === 0 ? 'Normal' : `S${action}`} width={32} height={32} />
                                    ) : (
                                      <span class="bb-ltc-action-badge">{action === 0 ? 'N' : `S${action}`}</span>
                                    )}
                                  </span>
                                );
                              })}
                            </span>
                          </div>
                        </div>
                        {challenge.skillLoop.description && (
                          <div class="bb-ltc-skill-loop-desc">{challenge.skillLoop.description}</div>
                        )}
                      </div>
                    )}
                  </div>
                </section>
              )}

              <!-- Element Weakness & Resistances -->
              <section class="bb-ltc-detail-section">
                <h2 class="bb-ltc-section-title">Element Weakness & Resistances</h2>
                <div class="bb-ltc-detail-card">
                  <div class="bb-ltc-resistances-grid">
                    <!-- Weakness -->
                    <div class="bb-ltc-resistance-item weakness">
                      <BuffIcon fileName={challenge.weakness.icon} alt={challenge.weakness.element} width={28} height={28} />
                      <div class="bb-ltc-resistance-info">
                        <div class="bb-ltc-resistance-name">{challenge.weakness.element}</div>
                        <div class="bb-ltc-resistance-value">+50% DMG (Weakness)</div>
                      </div>
                    </div>
                    <!-- Resistances -->
                    {challenge.resistances.map(res => (
                      <div class="bb-ltc-resistance-item">
                        <BuffIcon fileName={res.icon} alt={res.element} width={28} height={28} />
                        <div class="bb-ltc-resistance-info">
                          <div class="bb-ltc-resistance-name">{res.element}</div>
                          <div class="bb-ltc-resistance-value">-{res.reduction}% DMG</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </section>

              <!-- Status Effect Resistances -->
              <section class="bb-ltc-detail-section">
                <h2 class="bb-ltc-section-title">Status Effect Resistances</h2>
                <div class="bb-ltc-detail-card">
                  <div class="bb-ltc-resistances-grid">
                    {challenge.statusResistances.map(status => (
                      <div class={`bb-ltc-resistance-item ${status.exploitable ? 'exploitable' : ''} ${status.chance === 100 ? 'immune' : ''}`}>
                        <BuffIcon fileName={status.icon} alt={status.name} width={28} height={28} />
                        <div class="bb-ltc-resistance-info">
                          <div class="bb-ltc-resistance-name">{status.name}</div>
                          <div class="bb-ltc-resistance-value">
                            {status.chance}% ({status.level}){status.exploitable && ' - Exploitable!'}
                          </div>
                          {status.description && (
                            <div class="bb-ltc-resistance-desc">{status.description}</div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </section>

              <!-- Boss Debuffs (what the boss inflicts on you) -->
              {challenge.bossDebuffs && challenge.bossDebuffs.length > 0 && (
                <section class="bb-ltc-detail-section">
                  <h2 class="bb-ltc-section-title">Boss Debuffs (Inflicted on You)</h2>
                  <div class="bb-ltc-detail-card">
                    <div class="bb-ltc-resistances-grid">
                      {challenge.bossDebuffs.map(debuff => (
                        <div class="bb-ltc-resistance-item bb-ltc-boss-debuff">
                          <BuffIcon fileName={debuff.icon} alt={debuff.name} width={28} height={28} />
                          <div class="bb-ltc-resistance-info">
                            <div class="bb-ltc-resistance-name">{debuff.name}</div>
                            <div class="bb-ltc-resistance-value">{debuff.effect}</div>
                            <div class="bb-ltc-resistance-desc">
                              Duration: {debuff.duration}
                              {debuff.note && <span> • {debuff.note}</span>}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </section>
              )}

              <!-- Boss Skills -->
              <section class="bb-ltc-detail-section">
                <h2 class="bb-ltc-section-title">Boss Skills</h2>
                <div class="bb-ltc-detail-card">
                  {challenge.skills.damageFormula && (
                    <div class="bb-ltc-damage-formula">
                      <strong>Damage Formula:</strong> {challenge.skills.damageFormula}
                      <br /><small>Boss Base ATK: {challenge.skills.bossBaseAtk?.toLocaleString()}</small>
                    </div>
                  )}

                  {challenge.skills.passiveSkills && challenge.skills.passiveSkills.length > 0 && (
                    <>
                      <h3 style="font-size: 0.9rem; color: var(--bb-text-secondary); margin: 0 0 0.75rem 0; text-transform: uppercase; letter-spacing: 0.5px;">Passive Skills</h3>
                      <div class="bb-ltc-skills-list" style="margin-bottom: 1.5rem;">
                        {challenge.skills.passiveSkills.map(skill => (
                          <div class="bb-ltc-skill-item bb-ltc-passive-skill">
                            {skill.skillIcon && (
                              <div class="bb-ltc-skill-icon">
                                <SkillIcon skillId={skill.skillIcon} alt={skill.nameEn} width={40} height={40} />
                              </div>
                            )}
                            <div class="bb-ltc-skill-info">
                              <div class="bb-ltc-skill-name">
                                {skill.name}
                                <span class="bb-ltc-skill-name-en">({skill.nameEn})</span>
                              </div>
                              <div class="bb-ltc-passive-effect">{skill.effect}</div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </>
                  )}

                  <h3 style="font-size: 0.9rem; color: var(--bb-text-secondary); margin: 0 0 0.75rem 0; text-transform: uppercase; letter-spacing: 0.5px;">Normal Attack</h3>
                  <div class="bb-ltc-skills-list" style="margin-bottom: 1.5rem;">
                    <div class="bb-ltc-skill-item">
                      {challenge.skills.normalAttack.skillIcon && (
                        <div class="bb-ltc-skill-icon">
                          <SkillIcon skillId={challenge.skills.normalAttack.skillIcon} alt="Skill" width={40} height={40} />
                        </div>
                      )}
                      <div class="bb-ltc-skill-info">
                        <div class="bb-ltc-skill-name">
                          {challenge.skills.normalAttack.name}
                          <span class="bb-ltc-skill-name-en">({challenge.skills.normalAttack.nameEn})</span>
                        </div>
                        <div class="bb-ltc-skill-details">
                          <span class="bb-ltc-skill-detail">
                            <span class="bb-ltc-skill-detail-label">Target:</span>
                            <span class="bb-ltc-skill-detail-value">{challenge.skills.normalAttack.target}</span>
                          </span>
                          <span class="bb-ltc-skill-detail">
                            <span class="bb-ltc-skill-detail-label">DMG:</span>
                            <span class="bb-ltc-skill-detail-value">{challenge.skills.normalAttack.damage}</span>
                            {challenge.skills.normalAttack.baseDamage && (
                              <span class="bb-ltc-base-damage">= {challenge.skills.normalAttack.baseDamage.toLocaleString()}</span>
                            )}
                          </span>
                          <span class="bb-ltc-skill-detail">
                            <span class="bb-ltc-skill-detail-label">Type:</span>
                            <span class="bb-ltc-skill-detail-value">{challenge.skills.normalAttack.type}</span>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <h3 style="font-size: 0.9rem; color: var(--bb-text-secondary); margin: 0 0 0.75rem 0; text-transform: uppercase; letter-spacing: 0.5px;">Regular Skills</h3>
                  <div class="bb-ltc-skills-list" style="margin-bottom: 1.5rem;">
                    {challenge.skills.regularSkills.map(skill => (
                      <div class="bb-ltc-skill-item">
                        {skill.skillIcon && (
                          <div class="bb-ltc-skill-icon">
                            <SkillIcon skillId={skill.skillIcon} alt="Skill" width={40} height={40} />
                          </div>
                        )}
                        <div class="bb-ltc-skill-info">
                          <div class="bb-ltc-skill-name">
                            {skill.name}
                            <span class="bb-ltc-skill-name-en">({skill.nameEn})</span>
                          </div>
                          <div class="bb-ltc-skill-details">
                            <span class="bb-ltc-skill-detail">
                              <span class="bb-ltc-skill-detail-label">Target:</span>
                              <span class="bb-ltc-skill-detail-value">{skill.target}</span>
                            </span>
                            <span class="bb-ltc-skill-detail">
                              <span class="bb-ltc-skill-detail-label">DMG:</span>
                              <span class="bb-ltc-skill-detail-value">{skill.damage}</span>
                              {skill.baseDamage && (
                                <span class="bb-ltc-base-damage">= {skill.baseDamage.toLocaleString()}</span>
                              )}
                            </span>
                            {skill.cooldown && (
                              <span class="bb-ltc-skill-detail">
                                <span class="bb-ltc-skill-detail-label">CD:</span>
                                <span class="bb-ltc-skill-detail-value">{skill.cooldown}s</span>
                              </span>
                            )}
                          </div>
                          <div class="bb-ltc-skill-effect">
                            {skill.effect}
                            {skill.debuffIcons && skill.debuffIcons.length > 0 && (
                              <span class="bb-ltc-debuff-icons">
                                {skill.debuffIcons.map(icon => (
                                  <BuffIcon fileName={icon} alt="Debuff" width={20} height={20} />
                                ))}
                              </span>
                            )}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  <h3 style="font-size: 0.9rem; color: var(--bb-text-secondary); margin: 0 0 0.75rem 0; text-transform: uppercase; letter-spacing: 0.5px;">Time-Triggered Skills</h3>
                  <div class="bb-ltc-skills-list">
                    {challenge.skills.timeTriggeredSkills.map(skill => (
                      <div class="bb-ltc-skill-item">
                        <span class="bb-ltc-skill-time">@{skill.timeLeft}s</span>
                        {skill.skillIcon && (
                          <div class="bb-ltc-skill-icon">
                            <SkillIcon skillId={skill.skillIcon} alt="Skill" width={40} height={40} />
                          </div>
                        )}
                        <div class="bb-ltc-skill-info">
                          <div class="bb-ltc-skill-name">
                            {skill.name}
                            <span class="bb-ltc-skill-name-en">({skill.nameEn})</span>
                          </div>
                          <div class="bb-ltc-skill-details">
                            <span class="bb-ltc-skill-detail">
                              <span class="bb-ltc-skill-detail-label">Target:</span>
                              <span class="bb-ltc-skill-detail-value">{skill.target}</span>
                            </span>
                            {skill.damage && (
                              <span class="bb-ltc-skill-detail">
                                <span class="bb-ltc-skill-detail-label">DMG:</span>
                                <span class="bb-ltc-skill-detail-value">{skill.damage}</span>
                                {skill.baseDamage && (
                                  <span class="bb-ltc-base-damage">= {skill.baseDamage.toLocaleString()}</span>
                                )}
                              </span>
                            )}
                          </div>
                          <div class="bb-ltc-skill-effect">
                            {skill.effect}
                            {skill.debuffIcon && (
                              <span class="bb-ltc-debuff-icons">
                                <BuffIcon fileName={skill.debuffIcon} alt="Debuff" width={20} height={20} />
                              </span>
                            )}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {challenge.skills.conditionalSkills && challenge.skills.conditionalSkills.length > 0 && (
                    <>
                      <h3 style="font-size: 0.9rem; color: var(--bb-text-secondary); margin: 1.5rem 0 0.75rem 0; text-transform: uppercase; letter-spacing: 0.5px;">Conditional Skills</h3>
                      <div class="bb-ltc-skills-list">
                        {challenge.skills.conditionalSkills.map(skill => (
                          <div class="bb-ltc-skill-item bb-ltc-conditional-skill">
                            <span class="bb-ltc-skill-condition">{skill.condition}</span>
                            {skill.skillIcon && (
                              <div class="bb-ltc-skill-icon">
                                <SkillIcon skillId={skill.skillIcon} alt="Skill" width={40} height={40} />
                              </div>
                            )}
                            <div class="bb-ltc-skill-info">
                              <div class="bb-ltc-skill-name">
                                {skill.name}
                                <span class="bb-ltc-skill-name-en">({skill.nameEn})</span>
                              </div>
                              <div class="bb-ltc-skill-details">
                                <span class="bb-ltc-skill-detail">
                                  <span class="bb-ltc-skill-detail-label">Target:</span>
                                  <span class="bb-ltc-skill-detail-value">{skill.target}</span>
                                </span>
                                {skill.cooldown && (
                                  <span class="bb-ltc-skill-detail">
                                    <span class="bb-ltc-skill-detail-label">CD:</span>
                                    <span class="bb-ltc-skill-detail-value">{skill.cooldown}s</span>
                                  </span>
                                )}
                              </div>
                              <div class="bb-ltc-skill-effect">{skill.effect}</div>
                              {skill.note && (
                                <div class="bb-ltc-skill-note">{skill.note}</div>
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    </>
                  )}
                </div>
              </section>


              <!-- Recommended Characters -->
              {challenge.recommendedCharacters && challenge.recommendedCharacters.length > 0 && (
                <section class="bb-ltc-detail-section">
                  <h2 class="bb-ltc-section-title">Recommended Characters</h2>
                  <div class="bb-ltc-detail-card">
                    <div class="bb-ltc-recommended-chars">
                      {challenge.recommendedCharacters.map(slug => {
                        const char = getCharacterDataBySlug(slug);
                        if (!char) return null;
                        return (
                          <a href={`/guides/busty-burst/characters/${slug}`} class="bb-ltc-char-card">
                            <div class="bb-ltc-char-image">
                              <PaladinImage
                                characterId={char.characterId}
                                alt={char.displayName || char.name}
                                width={60}
                                height={60}
                                imageType="icon"
                              />
                            </div>
                            <div class="bb-ltc-char-info">
                              <span class="bb-ltc-char-name">{char.displayName || char.name}</span>
                              <div class="bb-ltc-char-badges">
                                <ElementImage element={char.element} width={16} height={16} />
                                <span class="bb-ltc-char-role">{char.role}</span>
                              </div>
                            </div>
                          </a>
                        );
                      })}
                    </div>
                  </div>
                </section>
              )}

              <!-- Team Composition -->
              {challenge.teamComposition && (
                <section class="bb-ltc-detail-section">
                  <h2 class="bb-ltc-section-title">Team Composition</h2>
                  <div class="bb-ltc-detail-card">
                    {challenge.teamComposition.note && (
                      <p class="bb-ltc-team-note">{challenge.teamComposition.note}</p>
                    )}

                    <!-- Main Team (6 Characters) -->
                    <div class="bb-ltc-team-section">
                      <h3 class="bb-ltc-team-section-title">Main Team (6)</h3>
                      <div class="bb-ltc-team-grid">
                        {challenge.teamComposition.mainTeam.map(member => {
                          const char = getCharacterDataBySlug(member.slug);
                          if (!char) return null;
                          return (
                            <a href={`/guides/busty-burst/characters/${member.slug}`} class="bb-ltc-char-card">
                              <div class="bb-ltc-char-image">
                                <PaladinImage
                                  characterId={char.characterId}
                                  alt={char.displayName || char.name}
                                  width={60}
                                  height={60}
                                  imageType="icon"
                                />
                              </div>
                              <div class="bb-ltc-char-info">
                                <span class="bb-ltc-char-name">{char.displayName || char.name}</span>
                                <div class="bb-ltc-char-badges">
                                  <ElementImage element={char.element} width={16} height={16} />
                                  <span class="bb-ltc-char-role">{char.role}</span>
                                </div>
                                {member.alternative && (
                                  <span class="bb-ltc-char-alt">or {member.alternative}</span>
                                )}
                              </div>
                            </a>
                          );
                        })}
                      </div>
                    </div>

                    <!-- Supports (10 Characters) -->
                    <div class="bb-ltc-team-section">
                      <h3 class="bb-ltc-team-section-title">Supports (10)</h3>
                      <div class="bb-ltc-support-grid">
                        {challenge.teamComposition.supports.map(support => {
                          const supportData = getSupportDataById(support.id);
                          if (!supportData) return null;
                          const lb5Stats = supportData.supportStats?.lb5 || {};
                          return (
                            <div class="bb-ltc-support-card">
                              <div class="bb-ltc-char-image">
                                <PaladinImage
                                  characterId={support.id}
                                  alt={supportData.name}
                                  width={50}
                                  height={50}
                                  imageType="icon"
                                />
                              </div>
                              <div class="bb-ltc-char-info">
                                <span class="bb-ltc-char-name">{supportData.name}</span>
                                <div class="bb-ltc-char-badges">
                                  <ElementImage element={supportData.element} width={14} height={14} />
                                  <WeaponIcon weapon={supportData.weapon} width={14} height={14} />
                                  <RarityImage rarity={supportData.rarity} width={72} height={36} />
                                </div>
                                <div class="bb-ltc-support-stats">
                                  {Object.entries(lb5Stats).map(([stat, value]) => (
                                    <span class="bb-ltc-support-stat">{stat}: {value}</span>
                                  ))}
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>

                      <!-- Support Totals -->
                      {(() => {
                        const totals = {};
                        const blessingCounts = {};
                        const weaponCounts = {};
                        const weaponInspirations = {
                          'Shot': { stat: 'Accuracy', values: [3, 6, 10] },
                          'Slash': { stat: 'Accuracy', values: [3, 6, 10] },
                          'Strike': { stat: 'Block', values: [3, 6, 10] },
                          'Throw': { stat: 'P.ATK/M.ATK', values: ['2%', '4%', '6%'] },
                          'Pierce': { stat: 'Action Speed', values: ['2%', '4%', '6%'] }
                        };
                        challenge.teamComposition.supports.forEach(support => {
                          const supportData = getSupportDataById(support.id);
                          if (!supportData) return;
                          const lb5Stats = supportData.supportStats?.lb5 || {};
                          Object.entries(lb5Stats).forEach(([stat, value]) => {
                            if (typeof value === 'number') {
                              totals[stat] = (totals[stat] || 0) + value;
                            }
                          });
                          if (supportData.supportBonus?.blessing?.effect) {
                            const blessingType = supportData.element;
                            blessingCounts[blessingType] = (blessingCounts[blessingType] || 0) + 1;
                          }
                          if (supportData.weapon) {
                            weaponCounts[supportData.weapon] = (weaponCounts[supportData.weapon] || 0) + 1;
                          }
                        });
                        return (
                          <div class="bb-ltc-support-totals">
                            <h4 class="bb-ltc-totals-title">Total Support Bonuses (LB5)</h4>
                            <div class="bb-ltc-totals-grid">
                              {Object.entries(totals).map(([stat, value]) => (
                                <div class="bb-ltc-total-item">
                                  <span class="bb-ltc-total-stat">{stat}</span>
                                  <span class="bb-ltc-total-value">+{value}</span>
                                </div>
                              ))}
                            </div>
                            <div class="bb-ltc-blessings-summary">
                              <h5 class="bb-ltc-blessings-title">Element Blessings (6 members = +15%)</h5>
                              <div class="bb-ltc-blessings-list">
                                {Object.entries(blessingCounts).map(([element, count]) => (
                                  <span class="bb-ltc-blessing-item" data-element={element}>
                                    <ElementImage element={element} width={16} height={16} />
                                    {element}: {count}x
                                  </span>
                                ))}
                              </div>
                            </div>
                            <div class="bb-ltc-inspirations-summary">
                              <h5 class="bb-ltc-blessings-title">Weapon Inspirations (6 members)</h5>
                              <div class="bb-ltc-blessings-list">
                                {Object.entries(weaponCounts).map(([weapon, count]) => {
                                  const insp = weaponInspirations[weapon];
                                  const bonus = count >= 6 ? insp.values[2] : count >= 4 ? insp.values[1] : count >= 2 ? insp.values[0] : null;
                                  // Don't show weapons that don't meet minimum threshold (2 members)
                                  if (bonus === null) return null;
                                  return (
                                    <span class="bb-ltc-blessing-item bb-ltc-weapon-item" data-weapon={weapon}>
                                      {weapon}: {count}x → {insp.stat} +{bonus}
                                    </span>
                                  );
                                })}
                              </div>
                            </div>
                          </div>
                        );
                      })()}
                    </div>
                  </div>
                </section>
              )}

            </article>
          </div>
        </main>
      </div>

      <Footer />
    </div>

    <Analytics />
  </body>
</html>
