---
// CSS imports are now handled by layouts for better organization
// Each layout imports the appropriate styles via index.css
import { SITE_TITLE } from '../consts';
import SpeedInsights from '@vercel/speed-insights/astro';

export interface Props {
  title: string;
  description: string;
  image?: string;
  shouldPreloadDefaultImage?: boolean;
  breadcrumbs?: Array<{ name: string; url: string }>;
}

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const {
  title,
  description,
  image = '/images/about.jpg',
  shouldPreloadDefaultImage = false,
  breadcrumbs,
} = Astro.props;
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<!-- Favicon - Comprehensive for all browsers and search engines -->
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="mask-icon" href="/android-chrome-192x192.png" color="#FFB74D" />
<meta name="msapplication-TileImage" content="/android-chrome-192x192.png" />
<meta name="msapplication-TileColor" content="#FFB74D" />

<!-- Language and Translation Meta Tags -->
<meta name="google" content="translate" />
<meta
  name="google-translate-customization"
  content="(g$||{}).Element&&g.Element.go?g.Element.go({}):false"
/>
<link rel="alternate" hreflang="en" href={canonicalURL} />
<link rel="alternate" hreflang="x-default" href={canonicalURL} />

<!-- Security Headers -->
<meta
  http-equiv="Content-Security-Policy"
  content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://vercel.live https://cdn.vercel-insights.com https://va.vercel-scripts.com https://translate.google.com https://translate.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://translate.googleapis.com https://translate.google.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: https://translate.googleapis.com https://translate.google.com; media-src 'self' https:; connect-src 'self' https://vercel.live https://vitals.vercel-insights.com https://translate.googleapis.com https://translate.google.com; object-src 'none'; base-uri 'self'; form-action 'self';"
/>
<meta http-equiv="X-Content-Type-Options" content="nosniff" />
<meta http-equiv="X-XSS-Protection" content="1; mode=block" />
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
<link rel="manifest" href="/manifest.json" />
<link rel="sitemap" href="/sitemap-index.xml" />
<link
  rel="alternate"
  type="application/rss+xml"
  title={SITE_TITLE}
  href={new URL('rss.xml', Astro.site)}
/>
<meta name="generator" content={Astro.generator} />

<!-- Performance Optimizations -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="dns-prefetch" href="https://vitals.vercel-analytics.com" />

<!-- Critical image preload -->
{
  shouldPreloadDefaultImage && (
    <link
      rel="preload"
      href="/images/about.jpg"
      as="image"
      type="image/jpeg"
      fetchpriority="high"
    />
  )
}

<!-- Critical CSS inline for above-the-fold content and CLS prevention -->
<style>
  /* Critical inline styles for maximum CLS prevention */
  :root {
    --bg-primary: #1a1a1a;
    --bg-secondary: #2a2a2a;
    --bg-dark: #1c1c1c;
    --text-primary: #ffffff;
    --text-secondary: #b3b3b3;
    --text-inverse: #ffffff;
    --amber-glow: #ffb74d;
    --teal-crystal: #00acc1;
    --rose-quartz: #f48fb1;
    --mocha-mousse: #a4785c;
    --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-display: 'Space Grotesk', system-ui, sans-serif;
  }

  /* Critical layout styles */
  body {
    margin: 0;
    padding: 0;
    font-family: var(--font-primary);
    background-color: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    /* Force hardware acceleration only where needed */
    contain: layout style;
  }

  /* Home body specific styles */
  .home-body {
    background: var(--bg-dark);
  }

  /* Critical hero section styles for LCP optimization */
  .hero-section {
    position: relative;
    padding: 6rem 2rem 8rem 2rem;
    min-height: 70vh;
    display: flex;
    align-items: center;
    contain: layout style paint;
  }

  .hero-content {
    position: relative;
    z-index: 10;
    text-align: center;
    max-width: 1200px;
    margin: 0 auto;
    contain: layout;
  }

  /* Critical hero title - this is your LCP element */
  .hero-title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 900;
    line-height: 1.1;
    color: var(--amber-glow);
    margin: 0 0 7.5rem 0;
    text-align: center;
    contain: layout style paint;
    /* Optimize for LCP */
    will-change: auto;
  }

  /* Critical CTA button styles */
  .hero-cta {
    display: flex;
    justify-content: center;
    margin-bottom: 3rem;
    contain: layout;
  }

  .cta-button {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1.25rem 2.5rem;
    background: rgba(255, 183, 77, 0.9);
    border: 2px solid rgba(255, 183, 77, 1);
    border-radius: 12px;
    color: #1a1a1a;
    text-decoration: none;
    font-family: var(--font-primary);
    font-weight: 700;
    font-size: 1.2rem;
    backdrop-filter: blur(12px);
    contain: layout style;
    transition: transform 0.2s ease;
  }

  .cta-button:hover {
    transform: translateY(-2px);
  }

  /* Background layers - simplified for performance */
  .bg-layer {
    position: fixed;
    inset: 0;
    contain: layout style paint;
  }

  .bg-primary {
    background: linear-gradient(135deg, var(--bg-dark) 0%, #2a2a2a 50%, var(--bg-dark) 100%);
  }

  .bg-accent-1 {
    background: radial-gradient(circle at 20% 80%, rgba(164, 120, 100, 0.1), transparent);
    pointer-events: none;
  }

  /* Home content wrapper */
  .home-content {
    position: relative;
    z-index: 10;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    contain: layout;
  }

  .home-content main {
    flex: 1;
  }

  .home-main {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0;
    contain: layout style;
  }

  /* Header fixed height to prevent CLS */
  .header-container {
    min-height: 72px;
    position: sticky;
    top: 0;
    z-index: 1000;
    background: rgba(28, 28, 28, 0.95);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--amber-glow);
    contain: layout style paint;
    will-change: transform;
  }

  /* Main layout container with fixed dimensions */
  .main-layout {
    max-width: 50rem;
    margin: 0 auto;
    padding: 8rem 2rem 4rem 2rem;
    min-height: 100vh;
    contain: layout style;
  }

  /* Featured card fixed dimensions to prevent CLS */
  .featured-card-container {
    margin-bottom: 3rem;
    min-height: 340px;
    contain: layout style paint;
  }

  .featured-card {
    background: var(--bg-primary);
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid var(--amber-glow);
    box-shadow: 0 12px 30px rgba(164, 120, 100, 0.2);
    min-height: 336px;
    contain: layout style paint;
    will-change: transform, box-shadow;
    transform: translateZ(0);
  }

  /* Image containers with fixed dimensions */
  .game-image-container {
    width: 160px;
    height: 160px;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0, 172, 193, 0.3);
    position: relative;
    background: linear-gradient(135deg, rgba(0, 172, 193, 0.1), rgba(255, 183, 77, 0.1));
    flex-shrink: 0;
  }

  .game-image {
    width: 160px;
    height: 160px;
    object-fit: cover;
    border-radius: 16px;
    position: relative;
    z-index: 1;
  }

  /* Timer card fixed heights */
  .timer-card {
    min-height: 3.5rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 0.5rem;
    border-radius: 6px;
  }

  .timer-text {
    min-height: 1rem;
    font-family: 'Courier New', monospace;
    font-size: 0.75rem;
    font-weight: 600;
  }

  /* Coming soon cards fixed height */
  .coming-soon-card {
    min-height: 180px;
    background: var(--bg-primary);
    border-radius: 16px;
    padding: 2rem;
    text-align: center;
    opacity: 0.8;
    contain: layout style;
    will-change: transform, opacity;
    transform: translateZ(0);
  }

  /* Action button fixed dimensions */
  .action-button {
    background: var(--amber-glow);
    color: white;
    padding: 1rem 2rem;
    border-radius: 25px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    min-height: 48px;
    cursor: pointer;
    will-change: transform, background-color;
    transform: translateZ(0);
    transition:
      transform 0.2s ease,
      background-color 0.2s ease;
  }

  /* Mobile optimizations */
  @media (max-width: 768px) {
    .main-layout {
      padding: 6rem 1rem 2rem 1rem;
    }

    .featured-card-container {
      min-height: auto;
    }

    /* Critical mobile hero optimizations */
    .hero-section {
      padding: 3rem 1rem 2rem 1rem;
      min-height: auto;
    }

    .hero-title {
      font-size: clamp(2rem, 8vw, 2.8rem);
      margin-bottom: 2rem;
    }

    .hero-cta {
      margin-bottom: 2rem;
    }

    /* Reduce complexity on mobile for performance */
    .bg-accent-2,
    .bg-accent-3 {
      display: none;
    }

    .bg-accent-1 {
      opacity: 0.5;
    }

    /* Disable heavy animations on mobile */
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* GPU acceleration only for specific animated elements */
  .animated,
  .rotating,
  .sliding,
  .showcase-container,
  .master-clock,
  .skin-card:hover {
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  /* Optimize will-change for animations */
  .animated {
    will-change: transform, opacity;
  }

  /* Remove will-change after animation completes */
  .animation-complete {
    will-change: auto;
  }
</style>

<!-- Canonical URL -->
<link rel="canonical" href={canonicalURL} />

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<meta
  name="keywords"
  content="gacha wiki, zone nova wiki, silver and blood wiki, gacha game guide, character database, damage mechanics, game strategies, mobile RPG, gacha tier list, character builds, team compositions, reroll guide, best characters, summoning guide, f2p guide, beginner guide, patch notes, event guide, meta analysis, character review"
/>

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website" />
<meta property="og:url" content={Astro.url} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={new URL(image, Astro.url)} />
<meta property="og:site_name" content="GachaWiki" />
<meta property="og:logo" content={new URL('/android-chrome-192x192.png', Astro.url)} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="GachaWiki - Gacha Game Guides and Database" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content={Astro.url} />
<meta property="twitter:title" content={title} />
<meta property="twitter:description" content={description} />
<meta property="twitter:image" content={new URL(image, Astro.url)} />

<!-- Critical Font Preloads for LCP Optimization -->
<link
  rel="preload"
  href="https://fonts.gstatic.com/s/spacegrotesk/v15/V8mQoQDjQSkFtoMM3T6r8E7mPbF4C9yUW4YqKjhc.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>
<link
  rel="preload"
  href="https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>

<!-- Google Fonts with optimized loading and fallback display -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Space+Grotesk:wght@300;400;500;700;900&family=Orbitron:wght@400;700;900&display=swap"
  rel="stylesheet"
  media="print"
  onload="this.media='all'"
/>

<!-- Fallback for font loading -->
<noscript>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Space+Grotesk:wght@300;400;500;700;900&family=Orbitron:wght@400;700;900&display=swap"
    rel="stylesheet"
  />
</noscript>

<!-- Enhanced Performance Hints -->
<link rel="dns-prefetch" href="https://fonts.googleapis.com" />
<link rel="dns-prefetch" href="https://fonts.gstatic.com" />
<link rel="dns-prefetch" href="https://vitals.vercel-analytics.com" />

<!-- Prefetch key pages for instant navigation -->
<link rel="prefetch" href="/guides/zone-nova/" />
<link rel="prefetch" href="/guides/silver-and-blood/" />
<link rel="prefetch" href="/about/" />
<link rel="prefetch" href="/guides/" />

<!-- Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker
        .register('/sw.js')
        .then(registration => {
          console.log('SW registered: ', registration);
        })
        .catch(registrationError => {
          console.log('SW registration failed: ', registrationError);
        });
    });
  }
</script>

<!-- Module preload for critical JavaScript -->

<!-- Cache control and security -->
<meta http-equiv="Cache-Control" content="public, max-age=31536000, immutable" />
<meta name="theme-color" content="#FFB74D" />
<meta name="msapplication-TileColor" content="#FFB74D" />
<meta name="referrer" content="strict-origin-when-cross-origin" />

<!-- Breadcrumb Schema Markup -->
{
  breadcrumbs && breadcrumbs.length > 0 && (
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'BreadcrumbList',
        itemListElement: [
          {
            '@type': 'ListItem',
            position: 1,
            name: 'GachaWiki',
            item: 'https://gachawiki.info',
          },
          ...breadcrumbs.map((breadcrumb, index) => ({
            '@type': 'ListItem',
            position: index + 2,
            name: breadcrumb.name,
            item: `https://gachawiki.info${breadcrumb.url}`,
          })),
        ],
      })}
    />
  )
}

<!-- Organization Schema for Search Engines -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "GachaWiki",
    "url": "https://gachawiki.info",
    "logo": "https://gachawiki.info/android-chrome-192x192.png",
    "description": "Your ultimate destination for gacha game guides, character databases, and gaming strategies",
    "sameAs": ["https://github.com/boring877/gacha-wiki"],
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "support",
      "url": "https://github.com/boring877/gacha-wiki/issues"
    }
  }
</script>

<!-- Website Schema for Search Engines -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "GachaWiki",
    "url": "https://gachawiki.info",
    "description": "Your ultimate destination for gacha game guides, character databases, and gaming strategies",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://gachawiki.info/search?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "publisher": {
      "@type": "Organization",
      "name": "GachaWiki",
      "logo": "https://gachawiki.info/android-chrome-192x192.png"
    }
  }
</script>

<!-- Speed Insights -->
{/* @ts-ignore */}
<SpeedInsights />
