---
// Recast Slot Machine Component
---

<div class="slot-machine-container">
  <h2>RECAST SLOT MACHINE</h2>

  <!-- Slot Machine Display -->
  <div class="slot-machine">
    <!-- Slot Windows -->
    <div class="slot-windows">
      <!-- Slot 1 -->
      <div class="slot-window" id="slot-1">
        <div class="slot-label">SLOT 1</div>
        <div class="slot-reel" id="reel-1">
          <div class="slot-item empty">
            <div class="tier-placeholder">-</div>
          </div>
        </div>
        <div class="lock-indicator" id="lock-1">LOCKED</div>
      </div>

      <!-- Slot 2 -->
      <div class="slot-window" id="slot-2">
        <div class="slot-label">SLOT 2</div>
        <div class="slot-reel" id="reel-2">
          <div class="slot-item empty">
            <div class="tier-placeholder">-</div>
          </div>
        </div>
        <div class="lock-indicator" id="lock-2">LOCKED</div>
      </div>

      <!-- Slot 3 -->
      <div class="slot-window" id="slot-3">
        <div class="slot-label">SLOT 3</div>
        <div class="slot-reel" id="reel-3">
          <div class="slot-item empty">
            <div class="tier-placeholder">-</div>
          </div>
        </div>
        <div class="lock-indicator" id="lock-3">LOCKED</div>
      </div>
    </div>

    <!-- Slot Probabilities Display -->
    <div class="probability-display">
      <div class="probability-row">
        <div class="prob-item prob-guaranteed">Slot 1: 100%</div>
        <div class="prob-item prob-medium">Slot 2: 50%</div>
        <div class="prob-item prob-low">Slot 3: 15%</div>
      </div>
      <div class="probability-note">
        <em>Note: Slot 3 has a 30% chance ONLY if Slot 2 succeeds (50% Ã— 30% = 15% total chance)</em
        >
      </div>
    </div>
  </div>

  <!-- Control Panel -->
  <div class="control-panel">
    <!-- Lock Controls -->
    <div id="lock-controls" class="hidden">
      <div class="lock-info">
        <span class="lock-info-text">Click slots to lock/unlock (Max: 2)</span>
        <span id="lock-counter" class="lock-counter">Locked: 0/2</span>
      </div>
      <div class="lock-button-container">
        <button class="slot-lock-btn" data-slot="1">Lock Slot 1</button>
        <button class="slot-lock-btn" data-slot="2">Lock Slot 2</button>
        <button class="slot-lock-btn" data-slot="3">Lock Slot 3</button>
      </div>
    </div>

    <!-- Spin Button -->
    <button id="spin-btn">
      PULL LEVER (Cost: <span id="hammer-cost">1</span> Hammer<span
        id="hammer-plural"
        class="hidden">s</span
      >)
    </button>

    <!-- Stats Display -->
    <div class="stats-container">
      <div class="stat-box">
        <div class="stat-box-label">Hammers Used</div>
        <div id="hammers-used" class="stat-box-value">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-box-label">Current Slots</div>
        <div id="current-slots" class="stat-box-value">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-box-label">Best Result</div>
        <div id="best-result" class="stat-box-value">-</div>
      </div>
    </div>
  </div>

  <!-- Reset Button -->
  <button id="reset-btn">Reset Machine</button>
</div>

<!-- Probability Breakdown -->
<div class="probability-section">
  <h3>Slot Probability Breakdown</h3>
  <div class="probability-details">
    <div class="prob-row">
      <strong class="prob-guaranteed">1 Slot:</strong> 100% chance (guaranteed)
    </div>
    <div class="prob-row">
      <strong class="prob-medium">2 Slots:</strong> 50% chance
    </div>
    <div class="prob-row">
      <strong class="prob-low">3 Slots:</strong> 15% chance (requires hitting both: 50% for slot 2, then
      30% for slot 3)
    </div>
    <div class="prob-note">
      <strong>With Locked Slots:</strong> Locked blessings guarantee their slots will appear (100% chance
      for locked slots)
    </div>
  </div>
</div>

<!-- History Section -->
<div class="history-section">
  <h3>Spin History</h3>
  <div id="history-log" class="history-log">
    <div class="history-empty">No spins yet...</div>
  </div>
</div>

<style>
  .slot-label {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    color: #888;
    font-size: 0.9rem;
  }

  .probability-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 1rem;
  }

  .probability-row {
    display: flex;
    justify-content: center;
    gap: 2rem;
    font-size: 0.9rem;
  }

  .probability-note {
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    text-align: center;
    max-width: 500px;
  }

  .prob-guaranteed {
    color: #4caf50;
  }

  .prob-medium {
    color: #ffa500;
  }

  .prob-low {
    color: #ff6b6b;
  }

  .probability-details {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.6;
  }

  .prob-row {
    margin-bottom: 0.75rem;
  }

  .prob-note {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.6);
  }

  .history-log {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    max-height: 200px;
    overflow-y: auto;
  }

  .history-empty {
    color: rgba(255, 255, 255, 0.4);
  }

  .slot-item.empty {
    color: #444;
    font-size: 2rem;
  }
</style>

<script>
  import '/src/scripts/sab-slot-machine.js';
</script>
