---
// Silver and Blood Centralized Data Component
// This component imports all character data files and provides them in a single module
// Data is now sourced from character-stats.json and characters_info.json

// Import other Silver and Blood data
import { characters, getCharacterById, CHARACTERS_BY_SLUG } from '../../data/silver-and-blood/characters.js';
import {
  PVE_TIER_LIST,
  PVP_TIER_LIST,
  CLAN_HUNT_TIER_LIST,
  BOSS_RAIDS_TIER_LIST,
  NEW_PLAYER_TIER_LIST,
} from '../../data/silver-and-blood/tier-lists.js';
import { rankings } from '../../data/silver-and-blood/character-rankings.js';

// Import all character images from assets
import acappellaImg from '../../assets/images/games/silver-and-blood/characters/acappella.jpg';
import agaresImg from '../../assets/images/games/silver-and-blood/characters/agares.jpg';
import agnesImg from '../../assets/images/games/silver-and-blood/characters/agnes.jpg';
import albrechtImg from '../../assets/images/games/silver-and-blood/characters/albrecht.jpg';
import fannyImg from '../../assets/images/games/silver-and-blood/characters/Fanny.jpg';
import genevieveImg from '../../assets/images/games/silver-and-blood/characters/Genevieve.jpg';
import amiImg from '../../assets/images/games/silver-and-blood/characters/ami.jpg';
import augustineImg from '../../assets/images/games/silver-and-blood/characters/augustine.jpg';
import bellaImg from '../../assets/images/games/silver-and-blood/characters/bella.jpg';
import cainImg from '../../assets/images/games/silver-and-blood/characters/cain.jpg';
import ceciaImg from '../../assets/images/games/silver-and-blood/characters/cecia.jpg';
import dalcarloImg from '../../assets/images/games/silver-and-blood/characters/dalcarlo.jpg';
import darciasImg from '../../assets/images/games/silver-and-blood/characters/darcias.jpg';
import edinaImg from '../../assets/images/games/silver-and-blood/characters/edina.jpg';
import fleetingBellaImg from '../../assets/images/games/silver-and-blood/characters/fleeting-bella.jpg';
import friedrichImg from '../../assets/images/games/silver-and-blood/characters/friedrich.jpg';
import gilrainImg from '../../assets/images/games/silver-and-blood/characters/gilrain.jpg';
import hatiImg from '../../assets/images/games/silver-and-blood/characters/hati.jpg';
import incendiaryAgaresImg from '../../assets/images/games/silver-and-blood/characters/incendiary-agares.jpg';
import jinxedSelenaImg from '../../assets/images/games/silver-and-blood/characters/jinxed-selena.jpg';
import joanImg from '../../assets/images/games/silver-and-blood/characters/joan.jpg';
import juliusImg from '../../assets/images/games/silver-and-blood/characters/julius.jpg';
import lamiaImg from '../../assets/images/games/silver-and-blood/characters/lamia.jpg';
import limineImg from '../../assets/images/games/silver-and-blood/characters/limine.jpg';
import loreleiImg from '../../assets/images/games/silver-and-blood/characters/lorelei.jpg';
import massImg from '../../assets/images/games/silver-and-blood/characters/mass.jpg';
import nicoleImg from '../../assets/images/games/silver-and-blood/characters/nicole.jpg';
import ottaviaImg from '../../assets/images/games/silver-and-blood/characters/ottavia.jpg';
import pavanaImg from '../../assets/images/games/silver-and-blood/characters/pavana.jpg';
import pieraImg from '../../assets/images/games/silver-and-blood/characters/piera.jpg';
import quinnImg from '../../assets/images/games/silver-and-blood/characters/quinn.jpg';
import reginaImg from '../../assets/images/games/silver-and-blood/characters/regina.jpg';
import ressaImg from '../../assets/images/games/silver-and-blood/characters/ressa.jpg';
import selenaImg from '../../assets/images/games/silver-and-blood/characters/selena.jpg';
import sethImg from '../../assets/images/games/silver-and-blood/characters/seth.jpg';
import sireneImg from '../../assets/images/games/silver-and-blood/characters/sirene.jpg';
import spectralGilrainImg from '../../assets/images/games/silver-and-blood/characters/spectral-gilrain.jpg';
import starryEyedAionaImg from '../../assets/images/games/silver-and-blood/characters/starry-eyed-aiona.jpg';
import stellaImg from '../../assets/images/games/silver-and-blood/characters/stella.jpg';
import theophaneImg from '../../assets/images/games/silver-and-blood/characters/theophane.jpg';
import thibaultImg from '../../assets/images/games/silver-and-blood/characters/thibault.jpg';
import timelessAionaImg from '../../assets/images/games/silver-and-blood/characters/timeless-aiona.jpg';
import transcendentAmiImg from '../../assets/images/games/silver-and-blood/characters/transcendent-ami.jpg';
import transcendentHatiImg from '../../assets/images/games/silver-and-blood/characters/transcendent-hati.jpg';
import transcendentNoahImg from '../../assets/images/games/silver-and-blood/characters/transcendent-noah.jpg';
import trisImg from '../../assets/images/games/silver-and-blood/characters/tris.jpg';
import valoraImg from '../../assets/images/games/silver-and-blood/characters/valora.jpg';
import vanHelsingImg from '../../assets/images/games/silver-and-blood/characters/van-helsing.jpg';
import yggdrasillImg from '../../assets/images/games/silver-and-blood/characters/yggdrasill.jpg';

// Create image URL map for client-side JavaScript usage
export const CHARACTER_IMAGE_MAP = {
  acappella: acappellaImg.src,
  agares: agaresImg.src,
  agnes: agnesImg.src,
  albrecht: albrechtImg.src,
  fanny: fannyImg.src,
  genevieve: genevieveImg.src,
  ami: amiImg.src,
  augustine: augustineImg.src,
  bella: bellaImg.src,
  cain: cainImg.src,
  cecia: ceciaImg.src,
  dalcarlo: dalcarloImg.src,
  darcias: darciasImg.src,
  edina: edinaImg.src,
  'fleeting-bella': fleetingBellaImg.src,
  friedrich: friedrichImg.src,
  gilrain: gilrainImg.src,
  hati: hatiImg.src,
  'incendiary-agares': incendiaryAgaresImg.src,
  'jinxed-selena': jinxedSelenaImg.src,
  joan: joanImg.src,
  julius: juliusImg.src,
  lamia: lamiaImg.src,
  limine: limineImg.src,
  lorelei: loreleiImg.src,
  mass: massImg.src,
  nicole: nicoleImg.src,
  ottavia: ottaviaImg.src,
  pavana: pavanaImg.src,
  piera: pieraImg.src,
  quinn: quinnImg.src,
  regina: reginaImg.src,
  ressa: ressaImg.src,
  selena: selenaImg.src,
  seth: sethImg.src,
  sirene: sireneImg.src,
  'spectral-gilrain': spectralGilrainImg.src,
  'starry-eyed-aiona': starryEyedAionaImg.src,
  stella: stellaImg.src,
  theophane: theophaneImg.src,
  thibault: thibaultImg.src,
  'timeless-aiona': timelessAionaImg.src,
  'transcendent-ami': transcendentAmiImg.src,
  'transcendent-hati': transcendentHatiImg.src,
  'transcendent-noah': transcendentNoahImg.src,
  tris: trisImg.src,
  valora: valoraImg.src,
  'van-helsing': vanHelsingImg.src,
  yggdrasill: yggdrasillImg.src,
};

// Create a mapping of character data by slug using the centralized characters data
export const CHARACTER_DATA_MAP = Object.fromEntries(
  characters.map(char => [char.id, char])
);

// Define the character interface based on actual data structure
export interface SilverBloodCharacter {
  id: string;
  name: string;
  title?: string;
  subtitle?: string;
  description?: string;
  image: string;
  tags?: string[];
  rarity: 'SSR' | 'SR' | 'R';
  class: 'Warrior' | 'Assassin' | 'Defender' | 'Marksman' | 'Sorcerer' | 'Enchanter';
  faction: 'Kingdom' | 'Ancestors' | 'Church' | 'Bloodborn';
  equipmentType: 'Light' | 'Medium' | 'Heavy';
  moonPhase: 'New Moon' | 'Crescent Moon' | 'Full Moon';
  attackType: 'P.DMG' | 'M.DMG' | 'Piercing DMG';
  stats: {
    hp: number;
    atk: number;
    pDef: number;
    mDef: number;
    atkSpd: number;
    bloodsoulRecovery: number;
    critRate: number;
    critDmgIncrease: number;
    allDmgBonus: number;
    allDmgReduction: number;
    pDmgBonus: number;
    mDmgBonus: number;
    receivedHealingBonus: number;
    bloodPower: number;
  };
  skills: Array<{
    name: string;
    type: 'Normal Attack' | 'Special' | 'Passive' | 'Ultimate';
    description: string;
    cost?: number;
  }>;
  mechanics?: {
    moonPhaseEffect?: string;
    attackTypeInfo?: string;
    equipmentNote?: string;
  };
  slug?: string;
  detailUrl?: string;
}

// Security: Sanitize character data to prevent XSS
export function escapeHtml(unsafe: string): string {
  return unsafe
    .replace(/&/g, '&')
    .replace(/</g, '<')
    .replace(/>/g, '>')
    .replace(/"/g, '"')
    .replace(/'/g, '&#039;');
}

// Security: Validate image URLs
export function isValidImageUrl(url: string): boolean {
  return (
    /^https?:\/\/[^\s<>"']+\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
    /^\/[^\s<>"']+\.(jpg|jpeg|png|gif|webp)$/i.test(url)
  );
}

// Security: Sanitize and validate character data
// Keep original names for data lookups, only escape for display
export const sanitizedCharacters = characters.map(char => ({
  ...char,
  originalName: char.name || '', // Keep original for tier lookups
  displayName: escapeHtml(char.name || ''), // Escaped version for display
  slug: char.id?.replace(/[^a-zA-Z0-9-_]/g, '') || '', // Use id as slug
  class: escapeHtml(char.class || ''),
  rarity: escapeHtml(char.rarity || ''),
  faction: escapeHtml(char.faction || ''),
  equipmentType: escapeHtml(char.equipmentType || ''),
  moonPhase: escapeHtml(char.moonPhase || ''),
  attackType: escapeHtml(char.attackType || ''),
  image: isValidImageUrl(char.image || '') ? char.image : '/images/placeholder.png',
}));

// Get unique values for filters
export const classes = [...new Set(characters.map(c => c.class).filter(Boolean))].sort();
export const factions = [...new Set(characters.map(c => c.faction).filter(Boolean))].sort();
export const equipmentTypes = [
  ...new Set(characters.map(c => c.equipmentType).filter(Boolean)),
].sort();
export const moonPhases = [...new Set(characters.map(c => c.moonPhase).filter(Boolean))].sort();
export const attackTypes = [...new Set(characters.map(c => c.attackType).filter(Boolean))].sort();
export const rarities = ['SSR', 'SR', 'R'];

// Re-export characters for easy access
export { characters };

// Re-export tier lists
export {
  PVE_TIER_LIST,
  PVP_TIER_LIST,
  CLAN_HUNT_TIER_LIST,
  BOSS_RAIDS_TIER_LIST,
  NEW_PLAYER_TIER_LIST,
};

// Re-export rankings
export { rankings };

// Export all data in a single object for easy consumption
export const SB_DATA = {
  characters,
  sanitizedCharacters,
  characterDataMap: CHARACTER_DATA_MAP,
  tierLists: {
    pve: PVE_TIER_LIST,
    pvp: PVP_TIER_LIST,
    clanHunt: CLAN_HUNT_TIER_LIST,
    bossRaids: BOSS_RAIDS_TIER_LIST,
    newPlayer: NEW_PLAYER_TIER_LIST,
  },
  rankings,
  filterOptions: {
    classes,
    factions,
    equipmentTypes,
    moonPhases,
    attackTypes,
    rarities,
  },
};

// This component doesn't render anything, it just provides data
---
