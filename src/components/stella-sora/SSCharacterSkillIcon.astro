---
// Stella Sora Character Skill Icon Component
// Simple component that displays just the character's skill icon (without element plate overlay)
import { Image } from 'astro:assets';

// Dynamically import all character skill images
const characterSkillImages = import.meta.glob<{ default: ImageMetadata }>(
  '../../assets/images/games/stella-sora/characters/*/skills/*.png',
  { eager: true }
);

// Create a nested map: characterSlug -> skillType -> ImageMetadata
const skillImageMap: Record<string, Record<string, ImageMetadata>> = {};
for (const [path, module] of Object.entries(characterSkillImages)) {
  // Extract character slug and skill type from path
  // Path format: ../../assets/images/games/stella-sora/characters/[char]/skills/[skill-type].png
  const match = path.match(/characters\/([^/]+)\/skills\/([^/]+)\.png$/);
  if (match) {
    const [, charSlug, skillType] = match;
    if (!skillImageMap[charSlug]) {
      skillImageMap[charSlug] = {};
    }
    skillImageMap[charSlug][skillType] = module.default;
  }
}

export interface Props {
  characterSlug: string;
  skillType: 'normal-attack' | 'skill' | 'support-skill' | 'ultimate';
  alt?: string;
  width?: number;
  height?: number;
  class?: string;
  loading?: 'lazy' | 'eager';
}

const {
  characterSlug,
  skillType,
  alt,
  width = 80,
  height = 80,
  class: className = '',
  loading = 'lazy',
} = Astro.props;

// Slug mapping for characters with different folder names
const slugFolderMap: Record<string, string> = {
  snowishlaru: 'snowish-laru',
};

// Get character slug (lowercase)
const rawSlug = characterSlug.toLowerCase();
const slug = slugFolderMap[rawSlug] || rawSlug;

// Get character-specific skill image
const characterSkills = skillImageMap[slug];
const skillSrc = characterSkills?.[skillType];

const imageAlt = alt || `${characterSlug} ${skillType}`;
---

{
  skillSrc ? (
    <Image
      src={skillSrc}
      alt={imageAlt}
      width={width}
      height={height}
      class={className}
      loading={loading}
      format="webp"
      quality={95}
    />
  ) : (
    <div
      class={`skill-icon-placeholder ${className}`}
      style={`width: ${width}px; height: ${height}px; display: flex; align-items: center; justify-content: center; background: #333; border-radius: 8px; color: #999; font-size: 10px;`}
    >
      {skillType}
    </div>
  )
}
