---
import { Image } from 'astro:assets';

export interface Props {
  imageName: string;
  alt: string;
  width?: number;
  height?: number;
  loading?: 'lazy' | 'eager';
  class?: string;
  quality?: number;
}

const {
  imageName,
  alt,
  width = 200,
  height = 200,
  loading = 'lazy',
  class: className,
  quality = 100,
} = Astro.props;

// Import the image from src/assets
type ImageModule = { default: any } | undefined;
const imageModules: Record<string, ImageModule> = import.meta.glob(
  '/src/assets/images/games/stella-sora/potential/Chitose/*.{jpg,jpeg,png,webp}',
  { eager: true }
);

// Try different path formats to find the image
let imageModule: ImageModule = undefined;

// Try with full path first
let imagePath = `/src/assets/images/games/stella-sora/potential/Chitose/${imageName}`;
imageModule = imageModules[imagePath];

// If not found, try relative path
if (!imageModule) {
  imagePath = `../../assets/images/games/stella-sora/potential/Chitose/${imageName}`;
  imageModule = imageModules[imagePath];
}

// If still not found, try just the filename
if (!imageModule) {
  const filename = imageName.split('/').pop(); // Get just the filename
  for (const [key, value] of Object.entries(imageModules)) {
    if (key.endsWith(filename)) {
      imageModule = value;
      break;
    }
  }
}

let imageSrc: any;
let imageAlt = alt;
if (imageModule?.default) {
  imageSrc = imageModule.default;
} else {
  // Fallback if image not found
  imageSrc = '';
  imageAlt = `Image not found: ${alt}`;
}
---

{
  imageSrc ? (
    <Image
      src={imageSrc}
      alt={imageAlt}
      width={width}
      height={height}
      loading={loading}
      class={className}
      quality={quality}
      format="webp"
    />
  ) : (
    <div
      class={`potential-image-placeholder ${className || ''}`}
      style={`width: ${width}px; height: ${height}px;`}
    >
      <span>Image not found</span>
    </div>
  )
}
