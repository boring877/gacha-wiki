---
import { Image } from 'astro:assets';

export interface Props {
  imageName: string;
  alt: string;
  width?: number;
  height?: number;
  loading?: 'lazy' | 'eager';
  class?: string;
  quality?: number;
}

const {
  imageName,
  alt,
  width = 120,
  height = 120,
  loading = 'lazy',
  class: className,
  quality = 100,
} = Astro.props;

// Import all notes images from src/assets
type ImageModule = { default: any } | undefined;
const imageModules: Record<string, ImageModule> = import.meta.glob(
  '/src/assets/images/games/stella-sora/Notes/*.{jpg,jpeg,png,webp}',
  { eager: true }
);

// Build the image path - handle both with and without extension
// Convert spaces to underscores for image filename lookup
let imageKey = imageName.replace(/\s+/g, '_');
if (!imageKey.includes('.')) {
  imageKey = `${imageKey}.jpg`;
}

const imagePath = `/src/assets/images/games/stella-sora/Notes/${imageKey}`;
const imageModule = imageModules[imagePath];

let imageSrc: any;
let imageAlt = alt;
if (imageModule?.default) {
  imageSrc = imageModule.default;
} else {
  // Fallback if image not found
  imageSrc = '';
  imageAlt = `Image not found: ${alt}`;
}
---

{
  imageSrc ? (
    <Image
      src={imageSrc}
      alt={imageAlt}
      width={width * 2}
      height={height * 2}
      loading={loading}
      class={`notes-image ${className || ''}`}
      style={`width: ${width}px; height: ${height}px;`}
      quality={quality}
      format="png"
    />
  ) : (
    <div
      class={`notes-image-placeholder ${className || ''}`}
      style={`width: ${width}px; height: ${height}px;`}
    >
      <span>?</span>
    </div>
  )
}

<style>
  .notes-image {
    border-radius: 8px;
    object-fit: contain;
  }

  .notes-image-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--ss-bg-tertiary, #1a1a2e);
    border: 1px solid var(--ss-border, #333);
    border-radius: 8px;
    color: var(--ss-text-secondary, #888);
    font-size: 0.75rem;
  }
</style>
