---
import TaimaninSquadClockLayout from '../../layouts/clock/TaimaninSquad.astro';
import { taimaninSquadConfig } from '../../data/clock/taimanin-squad.js';
import GameIcon from '../../assets/images/games/taimanin-squad/gameimg/icon.jpg';

// Page metadata
const title = 'Taimanin Squad Clock - Open Beta Countdown Timer | GachaWiki';
const description =
  'Taimanin Squad open beta countdown timer - Track the Taimanin Squad open beta launch with a real-time countdown. Never miss the open beta start with our precise JST server time clock. Open Beta starts January 15, 2026.';

// Create config with imported image
const games = [
  {
    ...taimaninSquadConfig,
    image: GameIcon,
  },
];
---

<TaimaninSquadClockLayout title={title} description={description} games={games}>
  <!-- Structured data for SEO -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Taimanin Squad Open Beta Countdown",
      "description": "Real-time countdown timer for Taimanin Squad open beta launch. Open Beta starts January 15, 2026 JST.",
      "url": "https://gachawiki.info/clock/taimanin-squad",
      "mainEntity": {
        "@type": "WebApplication",
        "name": "Taimanin Squad Open Beta Timer",
        "description": "Track Taimanin Squad open beta launch countdown. Open Beta starts January 15, 2026 in Japan.",
        "applicationCategory": "GameApplication",
        "operatingSystem": "Web Browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        }
      },
      "publisher": {
        "@type": "Organization",
        "name": "GachaWiki",
        "url": "https://gachawiki.info"
      }
    }
  </script>
</TaimaninSquadClockLayout>

<!-- Simple countdown script -->
<script define:vars={{ config: taimaninSquadConfig }}>
  let clockInterval;

  function initClock() {
    updateCountdown();
    updateCurrentTime();

    // Update every second
    clockInterval = setInterval(() => {
      updateCountdown();
      updateCurrentTime();
    }, 1000);
  }

  // Update Open Beta countdown
  function updateCountdown() {
    const now = new Date();
    const openBetaDate = new Date(config.openBetaDate);
    const timeDiff = openBetaDate.getTime() - now.getTime();

    const daysEl = document.getElementById('countdownDays');
    const hoursEl = document.getElementById('countdownHours');
    const minutesEl = document.getElementById('countdownMinutes');
    const secondsEl = document.getElementById('countdownSeconds');

    if (!daysEl || !hoursEl || !minutesEl || !secondsEl) return;

    if (timeDiff <= 0) {
      // Open Beta has started
      daysEl.textContent = '00';
      hoursEl.textContent = '00';
      minutesEl.textContent = '00';
      secondsEl.textContent = '00';
    } else {
      // Countdown active
      const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

      daysEl.textContent = days.toString().padStart(2, '0');
      hoursEl.textContent = hours.toString().padStart(2, '0');
      minutesEl.textContent = minutes.toString().padStart(2, '0');
      secondsEl.textContent = seconds.toString().padStart(2, '0');
    }
  }

  // Update current JST time display
  function updateCurrentTime() {
    const now = new Date();

    // Update current date (JST)
    const currentDateEl = document.getElementById('currentDate');
    if (currentDateEl) {
      const dateOptions = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      currentDateEl.textContent = now.toLocaleDateString('en-US', {
        ...dateOptions,
        timeZone: 'Asia/Tokyo',
      });
    }

    // Update current JST time
    const currentJSTEl = document.getElementById('currentJST');
    if (currentJSTEl) {
      const jstTime = now.toLocaleTimeString('en-US', {
        hour12: false,
        timeZone: 'Asia/Tokyo',
      });
      currentJSTEl.textContent = `JST ${jstTime}`;
    }
  }

  // Start clock when page is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initClock);
  } else {
    initClock();
  }

  // Cleanup on page unload
  window.addEventListener('beforeunload', () => {
    if (clockInterval) {
      clearInterval(clockInterval);
    }
  });
</script>
