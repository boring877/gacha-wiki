---
import TaimaninSquadClockLayout from '../../layouts/clock/TaimaninSquad.astro';
import { taimaninSquadConfig } from '../../data/clock/taimanin-squad.js';
import GameIcon from '../../assets/images/games/taimanin-squad/gameimg/icon.jpg';

// Page metadata
const title = 'Taimanin Squad Clock - Game Launch Countdown Timer | GachaWiki';
const description =
  'Taimanin Squad game launch countdown timer - Track the official launch with a real-time countdown. Game Launch & Open Beta Ends March 1, 2026 13:00 UTC.';

// Create config with imported image
const games = [
  {
    ...taimaninSquadConfig,
    image: GameIcon,
  },
];
---

<TaimaninSquadClockLayout title={title} description={description} games={games}>
  <!-- Structured data for SEO -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Taimanin Squad Game Launch Countdown",
      "description": "Real-time countdown timer for Taimanin Squad official launch. Game Launch March 1, 2026 13:00 UTC.",
      "url": "https://gachawiki.info/clock/taimanin-squad",
      "mainEntity": {
        "@type": "WebApplication",
        "name": "Taimanin Squad Game Launch Timer",
        "description": "Track Taimanin Squad game launch countdown. Launch March 1, 2026 13:00 UTC.",
        "applicationCategory": "GameApplication",
        "operatingSystem": "Web Browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        }
      },
      "publisher": {
        "@type": "Organization",
        "name": "GachaWiki",
        "url": "https://gachawiki.info"
      }
    }
  </script>
</TaimaninSquadClockLayout>

<!-- Countdown scripts -->
<script define:vars={{ config: taimaninSquadConfig }}>
  let clockInterval;

  function initClock() {
    updateCountdown();
    updateDaysSinceOpenBeta();
    updateCurrentTime();

    // Update every second
    clockInterval = setInterval(() => {
      updateCountdown();
      updateDaysSinceOpenBeta();
      updateCurrentTime();
    }, 1000);
  }

  // Update Game Launch countdown
  function updateCountdown() {
    const now = new Date();
    const launchDate = new Date(config.openBetaDate);
    const timeDiff = launchDate.getTime() - now.getTime();

    const daysEl = document.getElementById('countdownDays');
    const hoursEl = document.getElementById('countdownHours');
    const minutesEl = document.getElementById('countdownMinutes');
    const secondsEl = document.getElementById('countdownSeconds');

    if (!daysEl || !hoursEl || !minutesEl || !secondsEl) return;

    if (timeDiff <= 0) {
      // Game has launched
      daysEl.textContent = '00';
      hoursEl.textContent = '00';
      minutesEl.textContent = '00';
      secondsEl.textContent = '00';
    } else {
      // Countdown active
      const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

      daysEl.textContent = days.toString().padStart(2, '0');
      hoursEl.textContent = hours.toString().padStart(2, '0');
      minutesEl.textContent = minutes.toString().padStart(2, '0');
      secondsEl.textContent = seconds.toString().padStart(2, '0');
    }
  }

  // Update Days Since Open Beta
  function updateDaysSinceOpenBeta() {
    const now = new Date();
    const openBetaStart = new Date(config.openBetaStart.date);
    const timeDiff = now.getTime() - openBetaStart.getTime();

    const daysEl = document.getElementById('daysSinceOpenBeta');
    const hoursEl = document.getElementById('hoursSinceOpenBeta');
    if (!daysEl || !hoursEl) return;

    if (timeDiff <= 0) {
      // Open Beta hasn't started yet
      const daysUntil = Math.ceil(Math.abs(timeDiff) / (1000 * 60 * 60 * 24));
      daysEl.textContent = daysUntil;
      hoursEl.textContent = 'days until Open Beta';
    } else {
      // Open Beta has started
      const daysSince = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      const hoursSince = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutesSince = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      daysEl.textContent = daysSince;
      hoursEl.textContent = `${daysSince} days, ${hoursSince} hours, ${minutesSince} minutes`;
    }
  }

  // Update current JST time display
  function updateCurrentTime() {
    const now = new Date();

    // Update current date (JST)
    const currentDateEl = document.getElementById('currentDate');
    if (currentDateEl) {
      const dateOptions = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      currentDateEl.textContent = now.toLocaleDateString('en-US', {
        ...dateOptions,
        timeZone: 'Asia/Tokyo',
      });
    }

    // Update current JST time
    const currentJSTEl = document.getElementById('currentJST');
    if (currentJSTEl) {
      const jstTime = now.toLocaleTimeString('en-US', {
        hour12: false,
        timeZone: 'Asia/Tokyo',
      });
      currentJSTEl.textContent = `JST ${jstTime}`;
    }
  }

  // Start clock when page is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initClock);
  } else {
    initClock();
  }

  // Cleanup on page unload
  window.addEventListener('beforeunload', () => {
    if (clockInterval) {
      clearInterval(clockInterval);
    }
  });
</script>
