---
import WeaponDetailLayout from '../../../../layouts/horizon-walker/WeaponDetailLayout.astro';
import { WeaponImage } from '../../../../components/horizon-walker/index.astro';

// Import weapon data
import { HORIZON_WALKER_WEAPONS } from '../../../../data/horizon-walker/weapons.js';

export function getStaticPaths() {
  return HORIZON_WALKER_WEAPONS.map(weapon => {
    return {
      params: { weaponSlug: weapon.id.replace('-weapon', '') },
      props: { weapon },
    };
  });
}

const { weapon } = Astro.props;

// Find previous and next weapons for navigation
const currentIndex = HORIZON_WALKER_WEAPONS.findIndex(w => w.id === weapon.id);
const prevWeapon = currentIndex > 0 ? HORIZON_WALKER_WEAPONS[currentIndex - 1] : null;
const nextWeapon =
  currentIndex < HORIZON_WALKER_WEAPONS.length - 1
    ? HORIZON_WALKER_WEAPONS[currentIndex + 1]
    : null;

// SEO metadata
const title = `${weapon.name} - ${weapon.character.name}'s Weapon | Horizon Walker Wiki`;
const description = `Complete guide for ${weapon.name}, the exclusive ${weapon.rarity} weapon for ${weapon.character.name} in Horizon Walker. View stats, unique skills, and weapon details.`;

export const prerender = true;
---

<WeaponDetailLayout
  weapon={weapon}
  title={title}
  description={description}
  currentPageName={weapon.name}
>
  <div class="weapon-detail-container">
    <!-- Hero Section -->
    <section class="weapon-hero">
      <div class="weapon-hero-content">
        <div class="weapon-hero-image">
          <WeaponImage imageName={weapon.image} alt={weapon.name} width={350} height={400} />
        </div>

        <div class="weapon-hero-info">
          <h1 class="weapon-detail-name">{weapon.name}</h1>
          <p class="weapon-detail-type">
            {weapon.type} • <span class="hw-badge" data-rarity={weapon.rarity}>{weapon.rarity}</span
            >
          </p>

          <div class="weapon-detail-character">
            <span class="weapon-detail-character-label">Exclusive Weapon For</span>
            <span class="weapon-detail-character-name">{weapon.character.name}</span>
            <a
              href={`/guides/horizon-walker/characters/${weapon.character.slug}/`}
              class="weapon-detail-character-link"
            >
              View Character →
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Content Grid -->
    <div class="weapon-content-grid">
      <!-- Stats Section -->
      <section class="weapon-stats-card">
        <h2 class="weapon-stats-title">Weapon Stats</h2>

        {
          weapon.stats && Object.keys(weapon.stats).length > 0 ? (
            <div class="weapon-stats-list">
              {weapon.stats.weaponMeleeAtk && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Melee Attack</span>
                  <span class="weapon-stat-value">{weapon.stats.weaponMeleeAtk}</span>
                </div>
              )}
              {weapon.stats.meleeAtkPercent && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Melee ATK Bonus</span>
                  <span class="weapon-stat-value">+{weapon.stats.meleeAtkPercent}%</span>
                </div>
              )}
              {weapon.stats.weaponRangedAtk && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Ranged Attack</span>
                  <span class="weapon-stat-value">{weapon.stats.weaponRangedAtk}</span>
                </div>
              )}
              {weapon.stats.weaponMagicAtk && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Magic Attack</span>
                  <span class="weapon-stat-value">{weapon.stats.weaponMagicAtk}</span>
                </div>
              )}
              {weapon.stats.magicAtkBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Magic ATK Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.magicAtkBonus}</span>
                </div>
              )}
              {weapon.stats.critDmgBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Critical DMG Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.critDmgBonus}</span>
                </div>
              )}
              {weapon.stats.evade && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Evasion</span>
                  <span class="weapon-stat-value">{weapon.stats.evade}</span>
                </div>
              )}
              {weapon.stats.evadeBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Evasion Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.evadeBonus}</span>
                </div>
              )}
              {weapon.stats.meleeAtkBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Melee ATK Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.meleeAtkBonus}</span>
                </div>
              )}
              {weapon.stats.rangedAtkBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Ranged ATK Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.rangedAtkBonus}</span>
                </div>
              )}
              {weapon.stats.accuracyBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Accuracy Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.accuracyBonus}</span>
                </div>
              )}
              {weapon.stats.maxHpBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Max HP Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.maxHpBonus}</span>
                </div>
              )}
              {weapon.stats.spdBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Speed Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.spdBonus}</span>
                </div>
              )}
              {weapon.stats.apRecoveryBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">AP Recovery Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.apRecoveryBonus}</span>
                </div>
              )}
              {weapon.stats.startingApBonus && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Starting AP Bonus</span>
                  <span class="weapon-stat-value">{weapon.stats.startingApBonus}</span>
                </div>
              )}
              {weapon.stats.slashBoost && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Slash Boost</span>
                  <span class="weapon-stat-value">{weapon.stats.slashBoost}</span>
                </div>
              )}
              {weapon.stats.heatBoost && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Heat Boost</span>
                  <span class="weapon-stat-value">{weapon.stats.heatBoost}</span>
                </div>
              )}
              {weapon.stats.coldBoost && (
                <div class="weapon-stat-row">
                  <span class="weapon-stat-name">Cold Boost</span>
                  <span class="weapon-stat-value">{weapon.stats.coldBoost}</span>
                </div>
              )}
            </div>
          ) : (
            <p style="color: var(--hw-text-muted); font-style: italic;">
              No stat data available yet
            </p>
          )
        }
      </section>

      <!-- Skills Section -->
      <section class="weapon-skills-card">
        <div class="weapon-skills-header">
          <h2 class="weapon-skills-title">Weapon Skills</h2>
        </div>

        {
          weapon.uniqueSkill && (
            <div class="weapon-skill-block">
              <div class="weapon-skill-header">
                <h3 class="weapon-skill-name">{weapon.uniqueSkill.name}</h3>
                <span class="weapon-skill-type weapon-skill-unique">Unique</span>
              </div>
              <p class="weapon-skill-description">{weapon.uniqueSkill.description}</p>
            </div>
          )
        }
        {
          weapon.signatureSkill && (
            <div class="weapon-skill-block">
              <div class="weapon-skill-header">
                <h3 class="weapon-skill-name">{weapon.signatureSkill.name}</h3>
                <span class="weapon-skill-type weapon-skill-signature">Signature</span>
              </div>
              <p class="weapon-skill-description">{weapon.signatureSkill.description}</p>
            </div>
          )
        }

        {
          !weapon.uniqueSkill && !weapon.signatureSkill && (
            <p style="color: var(--hw-text-muted); font-style: italic;">
              Skill information coming soon
            </p>
          )
        }
      </section>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="weapon-nav">
    {
      prevWeapon && (
        <a href={`/guides/horizon-walker/weapons/${prevWeapon.id}/`} class="weapon-nav-btn">
          ← {prevWeapon.name}
        </a>
      )
    }

    <a href="/guides/horizon-walker/weapons/" class="weapon-nav-all"> All Weapons </a>

    {
      nextWeapon && (
        <a href={`/guides/horizon-walker/weapons/${nextWeapon.id}/`} class="weapon-nav-btn">
          {nextWeapon.name} →
        </a>
      )
    }
  </nav>
</WeaponDetailLayout>
