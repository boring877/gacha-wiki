---
import CharacterComparisonLayout from '../../../layouts/silver-and-blood/CharacterComparisonLayout.astro';
import CharacterComparisonLogic from '../../../components/silver-and-blood/CharacterComparisonLogic.astro';
import { Image } from 'astro:assets';
import { characters } from '../../../data/silver-and-blood/characters.js';

// Define the character interface based on actual data structure
interface SilverBloodCharacter {
  id: string;
  name: string;
  title?: string;
  subtitle?: string;
  description?: string;
  image: string;
  tags?: string[];
  rarity: 'SSR' | 'SR' | 'R';
  class: 'Warrior' | 'Assassin' | 'Defender' | 'Marksman' | 'Sorcerer' | 'Enchanter';
  faction: 'Kingdom' | 'Ancestors' | 'Church' | 'Bloodborn';
  equipmentType: 'Light' | 'Medium' | 'Heavy';
  moonPhase: 'New Moon' | 'Crescent Moon' | 'Full Moon';
  attackType: 'P.DMG' | 'M.DMG' | 'Piercing DMG';
  stats: {
    hp: number;
    atk: number;
    pDef: number;
    mDef: number;
    atkSpd: number;
    bloodsoulRecovery: number;
    critRate: number;
    critDmgIncrease: number;
    allDmgBonus: number;
    allDmgReduction: number;
    pDmgBonus: number;
    mDmgBonus: number;
    receivedHealingBonus: number;
    bloodPower: number;
  };
  skills: Array<{
    name: string;
    type: 'Normal Attack' | 'Special' | 'Passive' | 'Ultimate';
    description: string;
    cost?: number;
  }>;
  mechanics?: {
    moonPhaseEffect?: string;
    attackTypeInfo?: string;
    equipmentNote?: string;
  };
  slug?: string;
  detailUrl?: string;
}

// Extend Window interface for our global data
declare global {
  interface Window {
    silverBloodComparisonData?: {
      characterData: {
        characters: SilverBloodCharacter[];
      };
    };
    silverBloodCharacterComparison?: any;
    SILVER_BLOOD_COMPARISON_CLEANUP?: () => void;
  }
}

const title = 'Character Comparison Tool - Silver and Blood';
const description =
  'Compare multiple Silver and Blood characters side by side. Analyze stats, skills, and abilities to make informed decisions about your team composition.';
---

<CharacterComparisonLayout title={title} description={description}>
  <div class="comparison-page-intro">
    <h3>Silver & Blood Character Comparison</h3>
    <p>
      Select up to <strong>4 characters</strong> to compare their <strong>stats</strong>, <strong
        >moon phases</strong
      >, and <strong>abilities</strong> side by side. This tool helps you analyze <strong
        >character strengths</strong
      > and <strong>weaknesses</strong> to optimize your <strong>team composition</strong>.
    </p>
  </div>

  <div class="character-comparison-container">
    <!-- Character Selection -->
    <div class="character-selector">
      <h2>Select Characters to Compare</h2>

      <!-- Filters and Sort Controls -->
      <div class="filter-bar">
        <div class="filter-controls">
          <select class="filter-select" id="class-filter">
            <option value="">Class</option>
            <option value="Warrior">Warrior</option>
            <option value="Assassin">Assassin</option>
            <option value="Defender">Defender</option>
            <option value="Marksman">Marksman</option>
            <option value="Sorcerer">Sorcerer</option>
            <option value="Enchanter">Enchanter</option>
          </select>
          <select class="filter-select" id="rarity-filter">
            <option value="">Rarity</option>
            <option value="SSR">SSR</option>
            <option value="SR">SR</option>
            <option value="R">R</option>
          </select>
          <select class="filter-select" id="faction-filter">
            <option value="">Faction</option>
            <option value="Kingdom">Kingdom</option>
            <option value="Ancestors">Ancestors</option>
            <option value="Church">Church</option>
            <option value="Bloodborn">Bloodborn</option>
          </select>
          <select class="filter-select" id="moonphase-filter">
            <option value="">Moon Phase</option>
            <option value="New Moon">New Moon</option>
            <option value="Crescent Moon">Crescent Moon</option>
            <option value="Full Moon">Full Moon</option>
          </select>
        </div>

        <div class="controls-right">
          <div class="sort-controls">
            <button class="sort-btn" data-sort="hp">HP</button>
            <button class="sort-btn" data-sort="atk">ATK</button>
            <button class="sort-btn" data-sort="pDef">P.DEF</button>
            <button class="sort-btn" data-sort="mDef">M.DEF</button>
          </div>
          <button class="reset-btn" id="clear-filters">Reset</button>
        </div>
      </div>

      <div class="character-grid">
        {
          characters.map(character => (
            <button
              class="character-select-card"
              data-character-id={character.id}
              data-selected="false"
            >
              <Image
                src={character.image}
                alt={character.name}
                class="character-portrait"
                width={80}
                height={80}
                format="webp"
                quality={90}
                loading="lazy"
              />
              <div class="character-info">
                <h3>{character.name}</h3>
                <div class="character-badges">
                  <span class={`rarity-badge ${character.rarity.toLowerCase()}`}>
                    {character.rarity}
                  </span>
                  <span class={`class-badge ${character.class.toLowerCase().replace(' ', '-')}`}>
                    {character.class}
                  </span>
                </div>
              </div>
            </button>
          ))
        }
      </div>
    </div>

    <!-- Comparison Table -->
    <div class="comparison-table-container" id="comparison-table" style="display: none;">
      <h2>Character Comparison</h2>
      <div class="comparison-controls">
        <button id="clear-comparison" class="clear-btn">Clear All</button>
      </div>

      <!-- Desktop Premium View -->
      <div class="comparison-container comparison-table-wrapper">
        <div class="premium-comparison-container">
          <!-- Character Headers -->
          <div class="premium-character-headers">
            <div class="premium-character-column" data-character="1">
              <div class="premium-character-card">
                <div class="character-portrait-container">
                  <img class="premium-portrait" data-portrait="1" />
                  <div class="portrait-glow"></div>
                </div>
                <h3 class="character-name" data-name="1"></h3>
              </div>
            </div>
            <div class="premium-character-column" data-character="2">
              <div class="premium-character-card">
                <div class="character-portrait-container">
                  <img class="premium-portrait" data-portrait="2" />
                  <div class="portrait-glow"></div>
                </div>
                <h3 class="character-name" data-name="2"></h3>
              </div>
            </div>
            <div class="premium-character-column" data-character="3">
              <div class="premium-character-card">
                <div class="character-portrait-container">
                  <img class="premium-portrait" data-portrait="3" />
                  <div class="portrait-glow"></div>
                </div>
                <h3 class="character-name" data-name="3"></h3>
              </div>
            </div>
            <div class="premium-character-column" data-character="4">
              <div class="premium-character-card">
                <div class="character-portrait-container">
                  <img class="premium-portrait" data-portrait="4" />
                  <div class="portrait-glow"></div>
                </div>
                <h3 class="character-name" data-name="4"></h3>
              </div>
            </div>
          </div>

          <!-- Stats Comparison -->
          <div class="premium-stats-container">
            <!-- Basic Info Section -->
            <div class="premium-section">
              <div class="premium-section-header">
                <h4>Basic Information</h4>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">Class</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium" data-stat="class-1"></div>
                  <div class="stat-value-premium" data-stat="class-2"></div>
                  <div class="stat-value-premium" data-stat="class-3"></div>
                  <div class="stat-value-premium" data-stat="class-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">Faction</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium" data-stat="faction-1"></div>
                  <div class="stat-value-premium" data-stat="faction-2"></div>
                  <div class="stat-value-premium" data-stat="faction-3"></div>
                  <div class="stat-value-premium" data-stat="faction-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">Equipment</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium" data-stat="equipment-1"></div>
                  <div class="stat-value-premium" data-stat="equipment-2"></div>
                  <div class="stat-value-premium" data-stat="equipment-3"></div>
                  <div class="stat-value-premium" data-stat="equipment-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">Moon Phase</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium" data-stat="moon-1"></div>
                  <div class="stat-value-premium" data-stat="moon-2"></div>
                  <div class="stat-value-premium" data-stat="moon-3"></div>
                  <div class="stat-value-premium" data-stat="moon-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">Attack Type</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium" data-stat="attack-1"></div>
                  <div class="stat-value-premium" data-stat="attack-2"></div>
                  <div class="stat-value-premium" data-stat="attack-3"></div>
                  <div class="stat-value-premium" data-stat="attack-4"></div>
                </div>
              </div>
            </div>

            <!-- Combat Stats Section -->
            <div class="premium-section">
              <div class="premium-section-header">
                <h4>Combat Stats</h4>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">HP</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium numeric" data-stat="hp-1"></div>
                  <div class="stat-value-premium numeric" data-stat="hp-2"></div>
                  <div class="stat-value-premium numeric" data-stat="hp-3"></div>
                  <div class="stat-value-premium numeric" data-stat="hp-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">ATK</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium numeric" data-stat="atk-1"></div>
                  <div class="stat-value-premium numeric" data-stat="atk-2"></div>
                  <div class="stat-value-premium numeric" data-stat="atk-3"></div>
                  <div class="stat-value-premium numeric" data-stat="atk-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">P.DEF</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium numeric" data-stat="pdef-1"></div>
                  <div class="stat-value-premium numeric" data-stat="pdef-2"></div>
                  <div class="stat-value-premium numeric" data-stat="pdef-3"></div>
                  <div class="stat-value-premium numeric" data-stat="pdef-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">M.DEF</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium numeric" data-stat="mdef-1"></div>
                  <div class="stat-value-premium numeric" data-stat="mdef-2"></div>
                  <div class="stat-value-premium numeric" data-stat="mdef-3"></div>
                  <div class="stat-value-premium numeric" data-stat="mdef-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">ATK SPD</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium numeric" data-stat="atkspd-1"></div>
                  <div class="stat-value-premium numeric" data-stat="atkspd-2"></div>
                  <div class="stat-value-premium numeric" data-stat="atkspd-3"></div>
                  <div class="stat-value-premium numeric" data-stat="atkspd-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">CRIT Rate</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium numeric" data-stat="crit-1"></div>
                  <div class="stat-value-premium numeric" data-stat="crit-2"></div>
                  <div class="stat-value-premium numeric" data-stat="crit-3"></div>
                  <div class="stat-value-premium numeric" data-stat="crit-4"></div>
                </div>
              </div>
              <div class="premium-stat-row">
                <div class="stat-label-premium">CRIT DMG</div>
                <div class="premium-stat-values">
                  <div class="stat-value-premium numeric" data-stat="critdmg-1"></div>
                  <div class="stat-value-premium numeric" data-stat="critdmg-2"></div>
                  <div class="stat-value-premium numeric" data-stat="critdmg-3"></div>
                  <div class="stat-value-premium numeric" data-stat="critdmg-4"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Character Comparison Logic Component -->
  <CharacterComparisonLogic />
</CharacterComparisonLayout>
