---
import CharacterRankingsLayout from '../../../layouts/silver-and-blood/CharacterRankingsLayout.astro';
import { characters } from '../../../data/silver-and-blood/characters.js';
import {
  rankings,
  overallAnalysis,
  totalCharacters,
  statNames,
} from '../../../data/silver-and-blood/character-rankings.js';
import Breadcrumb from '../../../components/silver-and-blood/Breadcrumb.astro';
---

<CharacterRankingsLayout
  title="Character Rankings - Silver and Blood"
  description="View character stat rankings for HP, ATK, P.DEF, M.DEF, and Blood Power in Silver and Blood"
  gameTitle="Character Rankings"
>
  <!-- Breadcrumb Navigation -->
  <Breadcrumb
    items={[
      { name: 'Home', href: '/' },
      { name: 'Silver and Blood', href: '/guides/silver-and-blood/' },
      { name: 'Characters', href: '/guides/silver-and-blood/characters/' },
      { name: 'Character Rankings' },
    ]}
  />

  <section class="content-section">
    <div class="rankings-intro">
      <h2 class="section-title">Character Stat Rankings</h2>
      <p class="intro-text">
        See how each character ranks in key combat stats among all {totalCharacters} characters
      </p>
      <p class="level-note">All stats shown at Level 200 (current max level)</p>
    </div>

    <!-- Character Selector -->
    <div class="character-selector">
      <h3 class="selector-title">Select Character</h3>

      <!-- Filters and Sort Controls -->
      <div class="filter-bar">
        <div class="filter-controls">
          <select class="filter-select" id="class-filter">
            <option value="">Class</option>
            <option value="Warrior">Warrior</option>
            <option value="Assassin">Assassin</option>
            <option value="Defender">Defender</option>
            <option value="Marksman">Marksman</option>
            <option value="Sorcerer">Sorcerer</option>
            <option value="Enchanter">Enchanter</option>
          </select>
          <select class="filter-select" id="rarity-filter">
            <option value="">Rarity</option>
            <option value="SSR">SSR</option>
            <option value="SR">SR</option>
            <option value="R">R</option>
          </select>
          <select class="filter-select" id="faction-filter">
            <option value="">Faction</option>
            <option value="Kingdom">Kingdom</option>
            <option value="Ancestors">Ancestors</option>
            <option value="Church">Church</option>
            <option value="Bloodborn">Bloodborn</option>
          </select>
          <select class="filter-select" id="moonphase-filter">
            <option value="">Moon Phase</option>
            <option value="New Moon">New Moon</option>
            <option value="Crescent Moon">Crescent Moon</option>
            <option value="Full Moon">Full Moon</option>
          </select>
        </div>
        <div class="sort-controls">
          <button class="sort-btn" data-sort="hp">HP</button>
          <button class="sort-btn" data-sort="atk">ATK</button>
          <button class="sort-btn" data-sort="pDef">P.DEF</button>
          <button class="sort-btn" data-sort="mDef">M.DEF</button>
          <button class="sort-btn" data-sort="bloodPower">Blood Power</button>
          <button class="reset-btn" id="clear-filters">Reset</button>
        </div>
      </div>

      <!-- Character Grid -->
      <div class="character-grid" id="character-grid">
        {
          characters
            .sort((a, b) => overallAnalysis[a.id].overallRank - overallAnalysis[b.id].overallRank)
            .map(char => (
              <article
                class="character-select-card"
                data-character-id={char.id}
                role="button"
                tabindex="0"
                aria-label={`Select ${char.name}, ${char.rarity} ${char.class}, ranked #${overallAnalysis[char.id].overallRank}`}
              >
                <div
                  class="character-rank-number"
                  aria-label={`Rank ${overallAnalysis[char.id].overallRank}`}
                >
                  {overallAnalysis[char.id].overallRank}
                </div>
                <img
                  src={char.image}
                  alt={`${char.name} portrait`}
                  class="character-portrait"
                  width="80"
                  height="80"
                  loading="lazy"
                />
                <div class="character-info">
                  <h3>{char.name}</h3>
                  <div class="character-badges">
                    <span
                      class={`rarity-badge ${char.rarity.toLowerCase()}`}
                      aria-label={`${char.rarity} rarity`}
                    >
                      {char.rarity}
                    </span>
                    <span
                      class={`class-badge ${char.class.toLowerCase().replace(' ', '-')}`}
                      aria-label={`${char.class} class`}
                    >
                      {char.class}
                    </span>
                  </div>
                  <div class="character-stats" aria-label="Character statistics">
                    <div class="stat-item">
                      <span class="stat-label">HP</span>
                      <span class="stat-value">{char.stats.hp.toLocaleString()}</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">ATK</span>
                      <span class="stat-value">{char.stats.atk.toLocaleString()}</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">P.DEF</span>
                      <span class="stat-value">{char.stats.pDef.toLocaleString()}</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">M.DEF</span>
                      <span class="stat-value">{char.stats.mDef.toLocaleString()}</span>
                    </div>
                  </div>
                </div>
              </article>
            ))
        }
      </div>
    </div>

    <!-- Rankings Display -->
    <div id="rankings-display" class="rankings-display">
      <div id="character-info" class="character-info">
        <img id="character-image" class="character-image" />
        <h3 id="character-name" class="character-name"></h3>
        <p id="character-class" class="character-details"></p>
      </div>

      <div class="rankings-container">
        <h3 class="rankings-title">Stat Rankings</h3>

        <div id="rankings-grid" class="rankings-grid">
          {
            Object.keys(statNames).map(statKey => (
              <div class="ranking-card">
                <h4 class="ranking-card-title">{statNames[statKey]}</h4>
                <div class={`rank-display rank-${statKey}`} />
                <div class={`rank-total rank-${statKey}-total`} />
                <div class={`stat-value stat-${statKey}`} />
              </div>
            ))
          }
        </div>
      </div>

      <!-- Character Performance Analysis -->
      <div id="character-analysis" class="character-analysis" style="display: none;">
        <h4 class="character-analysis-title">Character Performance Breakdown</h4>
        <div class="performance-summary">
          <div class="summary-stats">
            <div class="summary-stat">
              <span class="summary-label">Overall Rank:</span>
              <span class="summary-value" id="overall-rank"></span>
              <span class="summary-note">out of {totalCharacters}</span>
            </div>
            <div class="summary-stat">
              <span class="summary-label">Top 3 Stats:</span>
              <div class="summary-stat-details">
                <span class="summary-count" id="top3-count"></span>
                <div class="stat-badges" id="top3-stats"></div>
              </div>
            </div>
            <div class="summary-stat">
              <span class="summary-label">Top 10 Stats:</span>
              <div class="summary-stat-details">
                <span class="summary-count" id="top10-count"></span>
                <div class="stat-badges" id="top10-stats"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Back to Database Link -->
    <div class="back-button-container">
      <a href="/guides/silver-and-blood/characters/" class="back-button">
        ‚Üê Back to Character Database
      </a>
    </div>
  </section>

  <!-- Set data for external script -->
  <script
    is:inline
    define:vars={{ characters, rankings, overallAnalysis, statNames, totalCharacters }}
  >
    window.silverBloodRankingsData = {
      characters,
      rankings,
      overallAnalysis,
      statNames,
      totalCharacters,
    };
  </script>

  <!-- Load external optimized script -->
  <script is:inline src="/scripts/character-rankings/silver-and-blood-rankings.js"></script>
</CharacterRankingsLayout>
