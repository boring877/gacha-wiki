---
import CharacterComparisonLayout from '../../../layouts/zone-nova/CharacterComparisonLayout.astro';
import CharacterComparisonLogic from '../../../components/zone-nova/CharacterComparisonLogic.astro';
import CharacterCardComparison from '../../../components/zone-nova/CharacterCardComparison.astro';
import { ZONE_NOVA_CHARACTERS } from '../../../data/zone-nova/characters.js';
import { ZONE_NOVA_FACTIONS } from '../../../data/zone-nova/factions.js';

// Define the character interface based on actual data structure
interface ZoneNovaCharacter {
  id: number;
  name: string;
  slug: string;
  detailUrl: string;
  image: string;
  rarity: 'SSR' | 'SR' | 'R';
  element: 'Fire' | 'Wind' | 'Holy' | 'Chaos' | 'Ice';
  class: 'Guardian' | 'Warrior' | 'Rogue' | 'Mage' | 'Buffer' | 'Debuffer' | 'Healer';
  role: 'Tank' | 'DPS' | 'Buffer' | 'Debuffer' | 'Healer';
  stats: {
    hp: number;
    attack: number;
    defense: number;
    energyRecovery: number;
    critRate: number;
    critDmg: number;
  };
  faction: string;
  teamSkill?: {
    name: string;
    description: string;
    requirements: {
      faction: string;
      element: string;
    };
  };
}

// Extend Window interface for our global data
declare global {
  interface Window {
    zoneNovaComparisonData?: {
      characterData: {
        characters: ZoneNovaCharacter[];
      };
    };
    zoneNovaCharacterComparison?: any;
    ZONE_NOVA_COMPARISON_CLEANUP?: () => void;
  }
}
---

<CharacterComparisonLayout
  title="Zone Nova Character Comparison - GachaWiki"
  description="Compare up to 4 Zone Nova characters side by side to analyze their stats, elements, and roles for optimal team building."
  gameTitle="Character Comparison Tool"
>
  <div class="comparison-page-content">
    <!-- Page Introduction -->
    <div class="comparison-page-intro">
      <h3>Zone Nova Character Comparison</h3>
      <p>
        Select up to <strong>4 characters</strong> to compare their <strong>stats</strong>, <strong
          >elements</strong
        >, and <strong>team skills</strong> side by side. This tool helps you analyze <strong
          >character strengths</strong
        > and <strong>weaknesses</strong> to optimize your <strong>team composition</strong>.
      </p>
    </div>

    <div class="character-comparison-container">
      <!-- Character Selection -->
      <div class="character-selector">
        <h2>Select Characters to Compare</h2>

        <!-- Filters and Sort Controls -->
        <div class="filter-bar">
          <div class="filter-controls">
            <select class="filter-select" id="role-filter">
              <option value="">Role</option>
              <option value="Tank">Tank</option>
              <option value="DPS">DPS</option>
              <option value="Buffer">Buffer</option>
              <option value="Debuffer">Debuffer</option>
              <option value="Healer">Healer</option>
            </select>
            <select class="filter-select" id="class-filter">
              <option value="">Class</option>
              <option value="Guardian">Guardian</option>
              <option value="Warrior">Warrior</option>
              <option value="Rogue">Rogue</option>
              <option value="Mage">Mage</option>
              <option value="Buffer">Buffer</option>
              <option value="Debuffer">Debuffer</option>
              <option value="Healer">Healer</option>
            </select>
            <select class="filter-select" id="rarity-filter">
              <option value="">Rarity</option>
              <option value="SSR">SSR</option>
              <option value="SR">SR</option>
              <option value="R">R</option>
            </select>
            <select class="filter-select" id="element-filter">
              <option value="">Element</option>
              <option value="Fire">Fire</option>
              <option value="Ice">Ice</option>
              <option value="Wind">Wind</option>
              <option value="Holy">Holy</option>
              <option value="Chaos">Chaos</option>
            </select>
            <select class="filter-select" id="faction-filter">
              <option value="">Faction</option>
              {
                Object.keys(ZONE_NOVA_FACTIONS).map(faction => (
                  <option value={faction}>{faction}</option>
                ))
              }
            </select>
          </div>

          <div class="controls-right">
            <div class="sort-controls">
              <button class="sort-btn" data-sort="hp">HP</button>
              <button class="sort-btn" data-sort="attack">ATK</button>
              <button class="sort-btn" data-sort="defense">DEF</button>
            </div>
            <button class="reset-btn" id="clear-filters">Reset</button>
          </div>
        </div>

        <!-- Character Grid - Pre-rendered with Astro Image optimization -->
        <div class="character-grid" id="character-grid">
          {
            ZONE_NOVA_CHARACTERS.map((char: any) => (
              <CharacterCardComparison character={char} isSelected={false} />
            ))
          }
        </div>
      </div>

      <!-- Comparison Display -->
      <div class="comparison-container" id="comparison-table">
        <h2>Character Comparison</h2>

        <div class="comparison-controls">
          <button
            class="clear-btn"
            id="clear-comparison"
            onclick="if(window.zoneNovaCharacterComparison) window.zoneNovaCharacterComparison.clearComparison();"
            >Clear Comparison</button
          >
        </div>

        <div class="comparison-table-wrapper">
          <!-- Premium Style Character Comparison -->
          <div class="premium-comparison-container">
            <!-- Character Headers -->
            <div class="premium-character-headers">
              <div class="premium-character-column" data-character="1">
                <div class="premium-character-card">
                  <div class="character-portrait-container">
                    <img class="premium-portrait" data-portrait="1" />
                    <div class="portrait-glow"></div>
                  </div>
                  <h3 class="character-name" data-name="1"></h3>
                </div>
              </div>
              <div class="premium-character-column" data-character="2">
                <div class="premium-character-card">
                  <div class="character-portrait-container">
                    <img class="premium-portrait" data-portrait="2" />
                    <div class="portrait-glow"></div>
                  </div>
                  <h3 class="character-name" data-name="2"></h3>
                </div>
              </div>
              <div class="premium-character-column" data-character="3">
                <div class="premium-character-card">
                  <div class="character-portrait-container">
                    <img class="premium-portrait" data-portrait="3" />
                    <div class="portrait-glow"></div>
                  </div>
                  <h3 class="character-name" data-name="3"></h3>
                </div>
              </div>
              <div class="premium-character-column" data-character="4">
                <div class="premium-character-card">
                  <div class="character-portrait-container">
                    <img class="premium-portrait" data-portrait="4" />
                    <div class="portrait-glow"></div>
                  </div>
                  <h3 class="character-name" data-name="4"></h3>
                </div>
              </div>
            </div>

            <!-- Stats Comparison -->
            <div class="premium-stats-container">
              <!-- Basic Info Section -->
              <div class="premium-section">
                <div class="premium-section-header">
                  <h4>Basic Information</h4>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Rarity</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium" data-stat="rarity-1"></div>
                    <div class="stat-value-premium" data-stat="rarity-2"></div>
                    <div class="stat-value-premium" data-stat="rarity-3"></div>
                    <div class="stat-value-premium" data-stat="rarity-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Class</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium" data-stat="class-1"></div>
                    <div class="stat-value-premium" data-stat="class-2"></div>
                    <div class="stat-value-premium" data-stat="class-3"></div>
                    <div class="stat-value-premium" data-stat="class-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Role</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium" data-stat="role-1"></div>
                    <div class="stat-value-premium" data-stat="role-2"></div>
                    <div class="stat-value-premium" data-stat="role-3"></div>
                    <div class="stat-value-premium" data-stat="role-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Faction</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium" data-stat="faction-1"></div>
                    <div class="stat-value-premium" data-stat="faction-2"></div>
                    <div class="stat-value-premium" data-stat="faction-3"></div>
                    <div class="stat-value-premium" data-stat="faction-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Element</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium" data-stat="element-1"></div>
                    <div class="stat-value-premium" data-stat="element-2"></div>
                    <div class="stat-value-premium" data-stat="element-3"></div>
                    <div class="stat-value-premium" data-stat="element-4"></div>
                  </div>
                </div>
              </div>

              <!-- Combat Stats Section -->
              <div class="premium-section">
                <div class="premium-section-header">
                  <h4>Combat Stats</h4>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">HP</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium numeric" data-stat="hp-1"></div>
                    <div class="stat-value-premium numeric" data-stat="hp-2"></div>
                    <div class="stat-value-premium numeric" data-stat="hp-3"></div>
                    <div class="stat-value-premium numeric" data-stat="hp-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">ATK</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium numeric" data-stat="attack-1"></div>
                    <div class="stat-value-premium numeric" data-stat="attack-2"></div>
                    <div class="stat-value-premium numeric" data-stat="attack-3"></div>
                    <div class="stat-value-premium numeric" data-stat="attack-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">DEF</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium numeric" data-stat="defense-1"></div>
                    <div class="stat-value-premium numeric" data-stat="defense-2"></div>
                    <div class="stat-value-premium numeric" data-stat="defense-3"></div>
                    <div class="stat-value-premium numeric" data-stat="defense-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Energy Recovery</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium numeric" data-stat="energy-1"></div>
                    <div class="stat-value-premium numeric" data-stat="energy-2"></div>
                    <div class="stat-value-premium numeric" data-stat="energy-3"></div>
                    <div class="stat-value-premium numeric" data-stat="energy-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">CRIT Rate</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium numeric" data-stat="crit-1"></div>
                    <div class="stat-value-premium numeric" data-stat="crit-2"></div>
                    <div class="stat-value-premium numeric" data-stat="crit-3"></div>
                    <div class="stat-value-premium numeric" data-stat="crit-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">CRIT DMG</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium numeric" data-stat="critdmg-1"></div>
                    <div class="stat-value-premium numeric" data-stat="critdmg-2"></div>
                    <div class="stat-value-premium numeric" data-stat="critdmg-3"></div>
                    <div class="stat-value-premium numeric" data-stat="critdmg-4"></div>
                  </div>
                </div>
              </div>

              <!-- Team Skill Section -->
              <div class="premium-section">
                <div class="premium-section-header">
                  <h4>Team Skill</h4>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Skill Name</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium team-skill-name" data-stat="teamskillname-1">
                    </div>
                    <div class="stat-value-premium team-skill-name" data-stat="teamskillname-2">
                    </div>
                    <div class="stat-value-premium team-skill-name" data-stat="teamskillname-3">
                    </div>
                    <div class="stat-value-premium team-skill-name" data-stat="teamskillname-4">
                    </div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Description</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium team-skill" data-stat="teamskill-1"></div>
                    <div class="stat-value-premium team-skill" data-stat="teamskill-2"></div>
                    <div class="stat-value-premium team-skill" data-stat="teamskill-3"></div>
                    <div class="stat-value-premium team-skill" data-stat="teamskill-4"></div>
                  </div>
                </div>
                <div class="premium-stat-row">
                  <div class="stat-label-premium">Requirements</div>
                  <div class="premium-stat-values">
                    <div class="stat-value-premium team-conditions" data-stat="teamconditions-1">
                    </div>
                    <div class="stat-value-premium team-conditions" data-stat="teamconditions-2">
                    </div>
                    <div class="stat-value-premium team-conditions" data-stat="teamconditions-3">
                    </div>
                    <div class="stat-value-premium team-conditions" data-stat="teamconditions-4">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Character Cards View -->
      <div class="character-cards-view" id="character-cards-view">
        <h3 class="cards-section-title">Character Comparison</h3>
        <div id="mobile-comparison-cards">
          <!-- Mobile character cards will be dynamically inserted here -->
        </div>
      </div>
    </div>

    <!-- Character Comparison Logic Component -->
    <CharacterComparisonLogic />
  </div>
</CharacterComparisonLayout>
