---
// Stella Sora Characters Database Page
import CharactersLayout from '../../../layouts/stella-sora/CharactersLayout.astro';
import CharacterFilterBar from '../../../components/stella-sora/CharacterFilterBar.astro';
import SSSortComponent from '../../../components/stella-sora/SSSortComponent.astro';
import SSCharacterImage from '../../../components/stella-sora/SSCharacterImage.astro';
import SSElementImage from '../../../components/stella-sora/SSElementImage.astro';
import { STELLA_SORA_CHARACTERS } from '../../../data/stella-sora/characters.js';

// Sort characters by HP initially (descending)
const sortedCharacters = [...STELLA_SORA_CHARACTERS].sort((a, b) => b.stats.hp - a.stats.hp);
---

<CharactersLayout
  title="Stella Sora Character Database - Complete Character List & Stats"
  description="Browse all Stella Sora characters with detailed stats, skills, and information. Filter by rarity, element, role, and more. Complete character database for Trekker collection."
  gameTitle="Character Database"
>
  <section class="page-content">
    <div class="content-wrapper">
      <!-- Database Controls Container -->
      <div class="database-controls-container">
        <!-- Controls Header -->
        <div class="controls-header">
          <h2 class="controls-title">Character Controls</h2>
          <!-- Global Clear Button -->
          <div class="global-clear-container">
            <button class="global-clear-btn" id="global-clear-btn">
              <span class="clear-icon">âœ•</span>
              <span class="clear-text">Clear All</span>
            </button>
          </div>
        </div>

        <!-- Controls Content -->
        <div class="controls-content">
          <!-- Filter Bar -->
          <CharacterFilterBar showFilters={true} />

          <!-- Sort Component -->
          <SSSortComponent />
        </div>
      </div>

      <!-- Character Statistics -->
      <div class="stats-overview">
        <h2>Character Overview</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number">{STELLA_SORA_CHARACTERS.length}</div>
            <div class="stat-label">Total Characters</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">
              {STELLA_SORA_CHARACTERS.filter(c => c.rarity === '5-Star').length}
            </div>
            <div class="stat-label">5-Star Characters</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">
              {STELLA_SORA_CHARACTERS.filter(c => c.rarity === '4-Star').length}
            </div>
            <div class="stat-label">4-Star Characters</div>
          </div>
        </div>
      </div>

      <!-- Character Database -->
      <div class="character-database">
        <div class="database-header">
          <h2>All Characters</h2>
          <p class="database-description">
            All stats shown at maximum stats. Click on any character to view detailed information.
          </p>
        </div>

        <!-- Desktop Table View -->
        <div class="character-table-container">
          <table class="character-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Image</th>
                <th>Name</th>
                <th>Rarity</th>
                <th>Element</th>
                <th>Icon</th>
                <th>Position</th>
                <th>Faction</th>
                <th>Trekker Style</th>
                <th>HP</th>
                <th>ATK</th>
                <th>DEF</th>
                <th>Crit%</th>
                <th>Crit DMG</th>
              </tr>
            </thead>
            <tbody id="character-table-body">
              {
                sortedCharacters.map((character, index) => (
                  <tr
                    class="character-row clickable-row"
                    data-name={character.name.toLowerCase()}
                    data-rarity={character.rarity}
                    data-element={character.element}
                    data-role={character.role}
                    data-slug={character.slug}
                  >
                    <td>{index + 1}</td>
                    <td>
                      <div class="character-image-container">
                        <SSCharacterImage
                          imageName={character.image}
                          alt={character.name}
                          class="character-img"
                          width={500}
                          height={500}
                        />
                      </div>
                    </td>
                    <td class="character-name">{character.name}</td>
                    <td>
                      <span
                        class={`rarity-badge ${character.rarity.toLowerCase().replace('-star', '-star').replace('5-star', 'five-star').replace('4-star', 'four-star').replace('3-star', 'three-star')}`}
                      >
                        {character.rarity}
                      </span>
                    </td>
                    <td>
                      <span class={`element-badge element-${character.element.toLowerCase()}`}>
                        {character.element}
                      </span>
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                      <div class="element-icon-container">
                        <SSElementImage
                          elementName={character.element}
                          alt={character.element}
                          class="element-icon"
                          width={100}
                          height={100}
                        />
                      </div>
                    </td>
                    <td>
                      <span class={`position-badge position-${character.role.toLowerCase()}`}>
                        {character.role}
                      </span>
                    </td>
                    <td>{character.faction}</td>
                    <td>
                      <span class="trekker-style-text">{character.trekkerStyle || ''}</span>
                    </td>
                    <td data-hp={character.stats.hp}>{character.stats.hp.toLocaleString()}</td>
                    <td data-attack={character.stats.attack}>
                      {character.stats.attack.toLocaleString()}
                    </td>
                    <td data-defense={character.stats.defense}>
                      {character.stats.defense.toLocaleString()}
                    </td>
                    <td data-critRate={character.stats.critRate}>{character.stats.critRate}%</td>
                    <td data-critDmg={character.stats.critDmg}>{character.stats.critDmg}%</td>
                  </tr>
                ))
              }
            </tbody>
          </table>
        </div>

        <!-- Mobile Card View -->
        <div class="character-cards-container" id="character-cards">
          {
            sortedCharacters.map(character => (
              <div
                class="character-card clickable-card"
                data-name={character.name.toLowerCase()}
                data-rarity={character.rarity}
                data-element={character.element}
                data-role={character.role}
                data-slug={character.slug}
              >
                {/* Card Header: Image + Basic Info */}
                <div class="mobile-card-header">
                  <div class="character-image-container">
                    <SSCharacterImage
                      imageName={character.image}
                      alt={character.name}
                      class="character-img"
                      width={500}
                      height={500}
                    />
                  </div>
                  <div class="mobile-card-title-group">
                    <h3 class="character-name">{character.name}</h3>
                    <div class="character-rarity">
                      <span
                        class={`rarity-badge ${character.rarity.toLowerCase().replace('-star', '-star').replace('5-star', 'five-star').replace('4-star', 'four-star').replace('3-star', 'three-star')}`}
                      >
                        {character.rarity}
                      </span>
                    </div>
                  </div>
                </div>

                {/* Section Divider */}
                <div class="mobile-card-divider" />

                {/* Primary Stats Section */}
                <div class="mobile-card-section">
                  <div class="section-title">Combat Stats</div>
                  <div class="mobile-card-stats mobile-card-primary-stats">
                    <div class="stat-item">
                      <span class="stat-value">{character.stats.hp.toLocaleString()}</span>
                      <span class="stat-label">HP</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-value">{character.stats.attack.toLocaleString()}</span>
                      <span class="stat-label">ATK</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-value">{character.stats.defense.toLocaleString()}</span>
                      <span class="stat-label">DEF</span>
                    </div>
                  </div>
                </div>

                {/* Section Divider */}
                <div class="mobile-card-divider" />

                {/* Metadata Section */}
                <div class="mobile-card-section">
                  <div class="section-title">Character Info</div>
                  <div class="mobile-card-metadata">
                    <div class="metadata-badges">
                      <span class={`element-badge element-${character.element.toLowerCase()}`}>
                        <SSElementImage
                          elementName={character.element}
                          width={50}
                          height={50}
                          alt={`${character.element} element icon`}
                        />
                        <span>{character.element}</span>
                      </span>
                      <span class={`position-badge position-${character.role.toLowerCase()}`}>
                        {character.role}
                      </span>
                      <span class="faction-badge">{character.faction}</span>
                      {character.trekkerStyle && (
                        <span class="trekker-style-text">{character.trekkerStyle}</span>
                      )}
                    </div>
                  </div>
                </div>

                {/* Advanced Stats Section */}
                <div class="mobile-card-section mobile-card-advanced-stats">
                  <div class="section-title">Advanced Stats</div>
                  <div class="mobile-card-stats mobile-card-secondary-stats">
                    <div class="stat-item">
                      <span class="stat-value">{character.stats.critRate}%</span>
                      <span class="stat-label">Crit%</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-value">{character.stats.critDmg}%</span>
                      <span class="stat-label">Crit DMG</span>
                    </div>
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </section>
</CharactersLayout>

<script>
  // Character Navigation Script
  // Handles click navigation to individual character pages

  function initializeCharacterNavigation() {
    // Get all clickable rows and cards
    const clickableRows = document.querySelectorAll('.clickable-row');
    const clickableCards = document.querySelectorAll('.clickable-card');

    // Add click event listeners to desktop table rows
    clickableRows.forEach(row => {
      row.addEventListener('click', function () {
        const slug = this.dataset.slug;
        if (slug) {
          window.location.href = `/guides/stella-sora/characters/${slug}`;
        }
      });

      // Add hover effect for better UX
      row.addEventListener('mouseenter', function () {
        this.style.cursor = 'pointer';
      });

      row.addEventListener('mouseleave', function () {
        this.style.cursor = 'default';
      });
    });

    // Add click event listeners to mobile cards
    clickableCards.forEach(card => {
      card.addEventListener('click', function () {
        const slug = this.dataset.slug;
        if (slug) {
          window.location.href = `/guides/stella-sora/characters/${slug}`;
        }
      });

      // Add hover effect for better UX
      card.addEventListener('mouseenter', function () {
        this.style.cursor = 'pointer';
      });

      card.addEventListener('mouseleave', function () {
        this.style.cursor = 'default';
      });
    });
  }

  // Initialize navigation when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeCharacterNavigation);
  } else {
    initializeCharacterNavigation();
  }
</script>
