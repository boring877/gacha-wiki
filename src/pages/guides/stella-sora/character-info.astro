---
// Stella Sora Character Profiles & Voice Actors Page
// Lists all characters with their personal profiles, voice actors, birthdays, and bios

import CharacterInfoLayout from '../../../layouts/stella-sora/CharacterInfoLayout.astro';
import SSCharacterSmallImage from '../../../components/stella-sora/SSCharacterSmallImage.astro';
import SSElementImage from '../../../components/stella-sora/SSElementImage.astro';
import SSRarityImage from '../../../components/stella-sora/SSRarityImage.astro';
import { characterInfo, getAllFactions } from '../../../data/stella-sora/character-info.js';

// Get all unique values for filters
const allFactions = getAllFactions();
const allElements = ['Ignis', 'Aqua', 'Ventus', 'Terra', 'Lux', 'Umbra'];
const allPositions = ['Vanguard', 'Versatile', 'Support'];

// Count stats
const total5Star = characterInfo.filter(c => c.rarity === 5).length;
const total4Star = characterInfo.filter(c => c.rarity === 4).length;

const title = 'Stella Sora Character Profiles & Voice Actors - Birthdays, Factions & Bios';
const description = `Complete Stella Sora character profiles database. View voice actors (CN/JP), birthdays, factions, and background stories for all ${characterInfo.length} characters.`;
const gameTitle = 'Character Profiles & Voice Actors';

// Structured data for SEO
const structuredData = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'ItemList',
      name: 'Stella Sora Character Profiles & Voice Actors',
      description: description,
      numberOfItems: characterInfo.length,
      itemListElement: characterInfo.map((char, index) => ({
        '@type': 'ListItem',
        position: index + 1,
        item: {
          '@type': 'Person',
          name: char.name,
          description: char.description,
          birthDate: char.birthday,
        },
      })),
    },
    {
      '@type': 'BreadcrumbList',
      itemListElement: [
        {
          '@type': 'ListItem',
          position: 1,
          name: 'Home',
          item: 'https://gachawiki.info',
        },
        {
          '@type': 'ListItem',
          position: 2,
          name: 'Guides',
          item: 'https://gachawiki.info/guides/',
        },
        {
          '@type': 'ListItem',
          position: 3,
          name: 'Stella Sora',
          item: 'https://gachawiki.info/guides/stella-sora/',
        },
        {
          '@type': 'ListItem',
          position: 4,
          name: 'Character Profiles & Voice Actors',
          item: 'https://gachawiki.info/guides/stella-sora/character-info/',
        },
      ],
    },
    {
      '@type': 'FAQPage',
      mainEntity: [
        {
          '@type': 'Question',
          name: 'How many characters are in Stella Sora?',
          acceptedAnswer: {
            '@type': 'Answer',
            text: `Stella Sora currently has ${characterInfo.length} playable characters, including ${total5Star} 5-star and ${total4Star} 4-star characters.`,
          },
        },
        {
          '@type': 'Question',
          name: 'Who are the voice actors in Stella Sora?',
          acceptedAnswer: {
            '@type': 'Answer',
            text: 'Stella Sora features voice acting in Chinese (CN) and Japanese (JP). Each character has dedicated voice actors for both languages.',
          },
        },
        {
          '@type': 'Question',
          name: 'What elements are in Stella Sora?',
          acceptedAnswer: {
            '@type': 'Answer',
            text: 'Stella Sora has 6 elements: Ignis (Fire), Aqua (Water), Ventus (Wind), Terra (Earth), Lux (Light), and Umbra (Dark).',
          },
        },
      ],
    },
  ],
};
---

<CharacterInfoLayout title={title} description={description} gameTitle={gameTitle}>
  {/* Structured Data for SEO */}
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify(structuredData)}
    slot="head"
  />

  <div class="character-info-page">
    {/* Stats Overview */}
    <div class="character-info-stats">
      <h2>Overview</h2>
      <div class="character-info-stats-grid">
        <div class="character-info-stat-card">
          <div class="character-info-stat-number">{characterInfo.length}</div>
          <div class="character-info-stat-label">Total Characters</div>
        </div>
        <div class="character-info-stat-card">
          <div class="character-info-stat-number">{total5Star}</div>
          <div class="character-info-stat-label">5-Star</div>
        </div>
        <div class="character-info-stat-card">
          <div class="character-info-stat-number">{total4Star}</div>
          <div class="character-info-stat-label">4-Star</div>
        </div>
        <div class="character-info-stat-card">
          <div class="character-info-stat-number">{allFactions.length}</div>
          <div class="character-info-stat-label">Factions</div>
        </div>
        <div class="character-info-stat-card">
          <div class="character-info-stat-number">{allElements.length}</div>
          <div class="character-info-stat-label">Elements</div>
        </div>
      </div>
    </div>

    {/* Filter Controls */}
    <div class="character-info-controls">
      <div class="character-info-filter-row">
        <div class="character-info-search-container">
          <input
            type="text"
            id="character-search"
            class="character-info-search-input"
            placeholder="Search by name, faction, or voice actor..."
            aria-label="Search characters by name, faction, or voice actor"
          />
        </div>
        <select
          id="element-filter"
          class="character-info-filter-select"
          aria-label="Filter by element"
        >
          <option value="">All Elements</option>
          {allElements.map(element => <option value={element}>{element}</option>)}
        </select>
        <select
          id="position-filter"
          class="character-info-filter-select"
          aria-label="Filter by position"
        >
          <option value="">All Positions</option>
          {allPositions.map(position => <option value={position}>{position}</option>)}
        </select>
        <select
          id="rarity-filter"
          class="character-info-filter-select"
          aria-label="Filter by rarity"
        >
          <option value="">All Rarities</option>
          <option value="5">5-Star</option>
          <option value="4">4-Star</option>
        </select>
        <select
          id="faction-filter"
          class="character-info-filter-select"
          aria-label="Filter by faction"
        >
          <option value="">All Factions</option>
          {allFactions.map(faction => <option value={faction}>{faction}</option>)}
        </select>
      </div>
    </div>

    {/* Character Cards Grid */}
    <div class="character-info-grid" id="character-grid">
      {
        characterInfo.map(char => (
          <div
            class="character-info-card"
            data-name={char.name.toLowerCase()}
            data-element={char.element}
            data-position={char.position}
            data-rarity={char.rarity}
            data-faction={char.faction}
            data-va-cn={char.voiceActor.cn.toLowerCase()}
            data-va-jp={char.voiceActor.jp.toLowerCase()}
          >
            {/* Card Header */}
            <div class="character-info-card-header">
              <div class="character-info-avatar">
                <SSCharacterSmallImage
                  characterName={char.name}
                  alt={char.name}
                  width={64}
                  height={64}
                />
              </div>
              <div class="character-info-header-text">
                <h3 class="character-info-name">{char.name}</h3>
                <div class="character-info-badges">
                  <span class="character-info-badge-with-icon">
                    <SSRarityImage rarity={char.rarity} width={60} height={14} />
                  </span>
                  <span class="character-info-badge-with-icon">
                    <SSElementImage elementName={char.element} width={20} height={20} />
                    {char.element}
                  </span>
                  <span class={`position-badge position-${char.position.toLowerCase()}`}>
                    {char.position}
                  </span>
                </div>
              </div>
            </div>

            {/* Card Body */}
            <div class="character-info-card-body">
              {/* Description */}
              <p class="character-info-description">{char.description}</p>

              {/* Personal Details Grid */}
              <div class="character-info-details">
                <div class="character-info-detail-item">
                  <span class="character-info-detail-label">Birthday</span>
                  <span class="character-info-detail-value">{char.birthday}</span>
                </div>
                <div class="character-info-detail-item">
                  <span class="character-info-detail-label">Faction</span>
                  <span class="character-info-detail-value">{char.faction}</span>
                </div>
                <div class="character-info-detail-item">
                  <span class="character-info-detail-label">Style</span>
                  <span class="character-info-detail-value">{char.style}</span>
                </div>
                <div class="character-info-detail-item">
                  <span class="character-info-detail-label">Attack Type</span>
                  <span class="character-info-detail-value">{char.attackType}</span>
                </div>
              </div>

              {/* Voice Actors */}
              <div class="character-info-voice-actors">
                <div class="character-info-va-title">Voice Actors</div>
                <div class="character-info-va-grid">
                  <div class="character-info-va-item">
                    <span class="character-info-va-lang">CN</span>
                    <span class="character-info-va-name">{char.voiceActor.cn}</span>
                    <span class="character-info-va-localized">{char.voiceActor.cnLocalized}</span>
                  </div>
                  <div class="character-info-va-item">
                    <span class="character-info-va-lang">JP</span>
                    <span class="character-info-va-name">{char.voiceActor.jp}</span>
                    <span class="character-info-va-localized">{char.voiceActor.jpLocalized}</span>
                  </div>
                </div>
              </div>

              {/* Tags */}
              <div class="character-info-tags">
                {char.tags.map(tag => (
                  <span class="character-info-tag">{tag}</span>
                ))}
              </div>
            </div>
          </div>
        ))
      }
    </div>

    {/* No Results Message */}
    <div class="character-info-no-results" id="no-results" style="display: none;">
      <h3>No characters found</h3>
      <p>Try adjusting your search or filter criteria.</p>
    </div>
  </div>
</CharacterInfoLayout>

<script>
  // Filter functionality
  function initFilters() {
    const searchInput = document.getElementById('character-search') as HTMLInputElement;
    const elementFilter = document.getElementById('element-filter') as HTMLSelectElement;
    const positionFilter = document.getElementById('position-filter') as HTMLSelectElement;
    const rarityFilter = document.getElementById('rarity-filter') as HTMLSelectElement;
    const factionFilter = document.getElementById('faction-filter') as HTMLSelectElement;
    const characterGrid = document.getElementById('character-grid');
    const noResults = document.getElementById('no-results');

    if (!characterGrid) return;

    const cards = characterGrid.querySelectorAll('.character-info-card');

    function filterCards() {
      const searchTerm = searchInput?.value.toLowerCase() || '';
      const elementValue = elementFilter?.value || '';
      const positionValue = positionFilter?.value || '';
      const rarityValue = rarityFilter?.value || '';
      const factionValue = factionFilter?.value || '';

      let visibleCount = 0;

      cards.forEach(card => {
        const cardEl = card as HTMLElement;
        const name = cardEl.dataset.name || '';
        const element = cardEl.dataset.element || '';
        const position = cardEl.dataset.position || '';
        const rarity = cardEl.dataset.rarity || '';
        const faction = cardEl.dataset.faction || '';
        const vaCn = cardEl.dataset.vaCn || '';
        const vaJp = cardEl.dataset.vaJp || '';

        // Check search term
        const matchesSearch =
          !searchTerm ||
          name.includes(searchTerm) ||
          faction.toLowerCase().includes(searchTerm) ||
          vaCn.includes(searchTerm) ||
          vaJp.includes(searchTerm);

        // Check filters
        const matchesElement = !elementValue || element === elementValue;
        const matchesPosition = !positionValue || position === positionValue;
        const matchesRarity = !rarityValue || rarity === rarityValue;
        const matchesFaction = !factionValue || faction === factionValue;

        const isVisible =
          matchesSearch && matchesElement && matchesPosition && matchesRarity && matchesFaction;

        cardEl.style.display = isVisible ? '' : 'none';
        if (isVisible) visibleCount++;
      });

      // Show/hide no results message
      if (noResults) {
        noResults.style.display = visibleCount === 0 ? '' : 'none';
      }
    }

    // Add event listeners
    searchInput?.addEventListener('input', filterCards);
    elementFilter?.addEventListener('change', filterCards);
    positionFilter?.addEventListener('change', filterCards);
    rarityFilter?.addEventListener('change', filterCards);
    factionFilter?.addEventListener('change', filterCards);
  }

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFilters);
  } else {
    initFilters();
  }
</script>
