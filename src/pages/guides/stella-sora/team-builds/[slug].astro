---
// Stella Sora Individual Team Build Page
// Dynamic route for individual team build pages using slug

import TeamBuildIndividualLayout from '../../../../layouts/stella-sora/TeamBuildIndividualLayout.astro';
import { getTeamBuildBySlug, getAllTeamBuilds } from '../../../../data/stella-sora/team-builds.js';
import PotentialImage from '../../../../components/stella-sora/PotentialImage.astro';
import SSCharacterImage from '../../../../components/stella-sora/SSCharacterImage.astro';
import HighlightedText from '../../../../components/stella-sora/HighlightedText.astro';

export async function getStaticPaths() {
  const teamBuilds = getAllTeamBuilds();

  return teamBuilds.map(teamBuild => ({
    params: { slug: teamBuild.slug },
    props: { teamBuild },
  }));
}

const { teamBuild } = Astro.props;

// SEO and layout props
const title = `${teamBuild.name} - Stella Sora Team Build`;
const description = `${teamBuild.description}. Complete guide with character composition, strengths, weaknesses, and build notes for this Stella Sora team.`;
const teamBuildName = teamBuild.name;
---

<TeamBuildIndividualLayout title={title} description={description} teamBuildName={teamBuildName}>
  <div class="team-build-detail">
    <!-- Important Note Section -->
    <div class="important-note-section">
      <div class="note-content">
        <h3 class="note-title">Important: Monolith Research</h3>
        <div class="note-text">
          <HighlightedText
            text="Monolith research should be completed to get the best outcome! It takes some time to get good RNG."
          />
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <!-- Team Composition -->
    <div>
      <h2 class="team-build-section-title">Team Composition</h2>
      <div class="team-build-characters-grid">
        {
          teamBuild.characters.map(character => (
            <div
              class={`team-character-card ${
                character.name === teamBuild.mainDps
                  ? 'main-dps'
                  : character.name === teamBuild.support
                    ? 'support'
                    : ''
              }`}
            >
              <div class="team-character-avatar" title={character.name}>
                <div class="team-character-image-wrapper">
                  <SSCharacterImage
                    imageName={character.image}
                    alt={character.name}
                    width={300}
                    height={300}
                    class="team-character-image"
                  />
                </div>
                <span class="team-character-initial">{character.name.charAt(0)}</span>
              </div>
              <div class="team-character-name">{character.name}</div>
              <div class="team-character-badges">
                <span class={`position-badge position-${character.role.toLowerCase()}`}>
                  {character.role}
                </span>
                <span
                  class={`rarity-badge ${character.rarity.toLowerCase().replace('5-star', 'five-star').replace('4-star', 'four-star').replace('3-star', 'three-star')}`}
                >
                  {character.rarity}
                </span>
                <span class={`element-badge element-${character.element.toLowerCase()}`}>
                  {character.element}
                </span>
              </div>
            </div>
          ))
        }
      </div>
    </div>

    <!-- Team Roles and Build Notes Side by Side -->
    <div class="team-info-row">
      <!-- Team Roles -->
      <div class="team-roles-section">
        <h2 class="team-build-section-title">Team Roles</h2>
        <div class="team-roles">
          <div class="role-card">
            <h4>Main DPS: {teamBuild.mainDps}</h4>
            <p>
              Shia is a Vanguard. Vanguards usually take the main place in the team and they deal
              the most damage.<br /><br />
              They also trigger Lux Mark. Shia is going to be our main dealer and the most focused character
              here.<br /><br />
              Make sure you put all the resources on her!
            </p>
          </div>
          {
            teamBuild.support && (
              <div class="role-card">
                <h4>Support: {teamBuild.support}</h4>
                <p>
                  Tilia provides a lot of support by increasing the ATK or damage taken.
                  <>
                    <br />
                    <br />
                  </>
                  She can also give shields. She is a really good 4-star character and very good in
                  our team!
                  <>
                    <br />
                    <br />
                  </>
                  She is our 2nd best character in the team.
                </p>
              </div>
            )
          }
          {
            teamBuild.flex &&
              teamBuild.flex !== teamBuild.mainDps &&
              teamBuild.flex !== teamBuild.support && (
                <div class="role-card">
                  <h4>Versatile: {teamBuild.flex}</h4>
                  <p>
                    Versatile kind of weird. They can trigger Lux Mark and also give Lux Mark.
                    <>
                      <br />
                      <br />
                    </>
                    Minova is not that good here and sometimes people change her with Jinglin.
                    <>
                      <br />
                      <br />
                    </>
                    One thing good about Minova is her shield is really powerful, and she gets it
                    every time she uses her support skill.
                  </p>
                </div>
              )
          }
        </div>
      </div>

      <!-- Build Notes -->
      <div class="build-notes-section">
        <h2 class="team-build-section-title">Build Notes</h2>
        <div class="team-build-notes">
          <div set:html={teamBuild.buildNotes} />
        </div>
      </div>
    </div>

    <!-- Potential Build -->
    {
      teamBuild.characterBuilds && (
        <div>
          <h2 class="team-build-section-title">Potential Build</h2>
          {Object.entries(teamBuild.characterBuilds).map(([characterKey, characterBuild]) => (
            <div class="character-potentials">
              <h3 class="character-name">
                {characterKey.charAt(0).toUpperCase() + characterKey.slice(1)} -{' '}
                {characterBuild.buildName}
              </h3>

              {characterBuild.potentialCategories
                ? // New categorized structure
                  Object.entries(characterBuild.potentialCategories).map(
                    ([categoryKey, category]) => (
                      <div class="potential-category">
                        <h4 class="category-title">{category.title}</h4>
                        <div class="potentials-list">
                          {category.potentials.map(potential =>
                            potential.isSubHeader ? (
                              <div class="potential-subheader">
                                <h5 class="subheader-title">{potential.name}</h5>
                                <p class="subheader-description">{potential.description}</p>
                              </div>
                            ) : (
                              <div class="potential-item">
                                <PotentialImage
                                  imageName={potential.image}
                                  alt={potential.name}
                                  width={150}
                                  height={150}
                                  class="potential-icon"
                                />
                                <div class="potential-content">
                                  <div class="potential-header">
                                    <h5 class="potential-name">{potential.name}</h5>
                                    {potential.level && (
                                      <span class="potential-level">{potential.level}</span>
                                    )}
                                  </div>
                                  <div class="potential-description">
                                    <HighlightedText text={potential.description} />
                                  </div>
                                </div>
                              </div>
                            )
                          )}
                        </div>
                      </div>
                    )
                  )
                : // Old structure fallback
                  characterBuild.potentials.map(potential => (
                    <div class="potential-item">
                      <PotentialImage
                        imageName={potential.image}
                        alt={potential.name}
                        width={150}
                        height={150}
                        class="potential-icon"
                      />
                      <div class="potential-content">
                        <div class="potential-header">
                          <h5 class="potential-name">{potential.name}</h5>
                          {potential.level && (
                            <span class="potential-level">{potential.level}</span>
                          )}
                        </div>
                        <div class="potential-description">
                          <HighlightedText text={potential.description} />
                        </div>
                      </div>
                    </div>
                  ))}
            </div>
          ))}
        </div>
      )
    }
  </div>
</TeamBuildIndividualLayout>
