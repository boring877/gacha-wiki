---
import BuildLandingLayout from '../../../../layouts/busty-burst/BuildLandingLayout.astro';
import { buildConfig } from '../../../../data/busty-burst/build.js';
import PaladinImage from '../../../../components/busty-burst/PaladinImage.astro';
import RarityImage from '../../../../components/busty-burst/RarityImage.astro';
import ElementImage from '../../../../components/busty-burst/ElementImage.astro';
import WeaponIcon from '../../../../components/busty-burst/WeaponIcon.astro';
import TypeofATKImage from '../../../../components/busty-burst/TypeofATKImage.astro';
import { BUSTY_BURST_PALADINS } from '../../../../data/busty-burst/paladins.js';

const { meta, characters } = buildConfig;

// Helper to get characterId from fileName
const getCharacterId = (fileName: string) => {
  const paladin = BUSTY_BURST_PALADINS.find(p =>
    p.fileName === fileName ||
    p.fileName.toLowerCase() === fileName.toLowerCase()
  );
  return paladin?.characterId || 2001;
};
---

<BuildLandingLayout
  title={meta.title}
  description={meta.description}
  gameTitle={meta.gameTitle}
  showTitle={true}
>
  <div class="bb-build-page-container">
    <section class="bb-build-content-section">
      <h2 class="bb-build-section-title">Available Builds</h2>
      <div class="bb-build-grid">
        {
          characters.map(character => (
            <a href={character.buildLink} class="bb-build-card">
              <div class="bb-build-card-image">
                <PaladinImage
                  characterId={getCharacterId(character.fileName)}
                  alt={character.name}
                  width={120}
                  height={120}
                  quality={95}
                  loading="eager"
                />
              </div>
              <div class="bb-build-card-info">
                <h3 class="bb-build-card-name">{character.name}</h3>
                <div class="bb-build-card-icons">
                  <RarityImage rarity={character.rarity} width={32} height={32} />
                  <ElementImage element={character.element} width={24} height={24} />
                  <TypeofATKImage fileName={`${character.attackType}.png`} alt={character.attackType} width={24} height={24} />
                  <WeaponIcon weapon={character.weaponType || 'Slash'} width={24} height={24} />
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </section>
  </div>
</BuildLandingLayout>

<style>
  .bb-build-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .bb-build-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bb-bg-secondary);
    border: 1px solid var(--bb-border);
    border-radius: 8px;
    text-decoration: none;
    color: inherit;
    cursor: pointer;
  }

  .bb-build-card:hover {
    border-color: var(--bb-primary, #ff6b6b);
  }

  .bb-build-card-image {
    width: 80px;
    height: 80px;
    flex-shrink: 0;
    border-radius: 6px;
    overflow: hidden;
    background: var(--bb-bg-primary);
    border: 1px solid var(--bb-border);
  }

  .bb-build-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .bb-build-card-info {
    flex: 1;
    min-width: 0;
  }

  .bb-build-card-name {
    font-size: 1rem;
    font-weight: 600;
    color: var(--bb-text-primary);
    margin: 0 0 0.5rem 0;
    line-height: 1.3;
  }

  .bb-build-card-icons {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .bb-build-card-icons img {
    flex-shrink: 0;
  }

  .bb-build-card-icons .typeofattk-image-wrapper {
    display: flex;
    align-items: center;
  }

  @media (max-width: 600px) {
    .bb-build-grid {
      grid-template-columns: 1fr;
    }

    .bb-build-card {
      padding: 0.875rem;
    }

    .bb-build-card-image {
      width: 70px;
      height: 70px;
    }

    .bb-build-card-name {
      font-size: 0.95rem;
    }

    .bb-build-card-icons {
      gap: 0.35rem;
      flex-wrap: wrap;
    }

    .bb-build-card-icons img {
      width: 20px !important;
      height: 20px !important;
    }

    .bb-build-card-icons img:first-child {
      width: 26px !important;
      height: 26px !important;
    }
  }
</style>
